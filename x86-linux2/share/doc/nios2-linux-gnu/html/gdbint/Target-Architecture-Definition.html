<html lang="en">
<head>
<title>Target Architecture Definition - GDB Internals</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="GDB Internals">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="start" href="index.html#Top">
<link rel="prev" href="Host-Definition.html#Host-Definition" title="Host Definition">
<link rel="next" href="Target-Descriptions.html#Target-Descriptions" title="Target Descriptions">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
--></style>
</head>
<body>
<div class="node">
<p>
<a name="Target-Architecture-Definition"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="Target-Descriptions.html#Target-Descriptions">Target Descriptions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Host-Definition.html#Host-Definition">Host Definition</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="index.html#Top">Top</a>
<hr>
</div>

<h2 class="chapter">9 Target Architecture Definition</h2>

<p><a name="index-target-architecture-definition-214"></a><span class="sc">gdb</span>'s target architecture defines what sort of
machine-language programs <span class="sc">gdb</span> can work with, and how it works
with them.

   <p>The target architecture object is implemented as the C structure
<code>struct gdbarch *</code>.  The structure, and its methods, are generated
using the Bourne shell script <samp><span class="file">gdbarch.sh</span></samp>.

<h3 class="section">9.1 Operating System ABI Variant Handling</h3>

<p><a name="index-OS-ABI-variants-215"></a>
<span class="sc">gdb</span> provides a mechanism for handling variations in OS
ABIs.  An OS ABI variant may have influence over any number of
variables in the target architecture definition.  There are two major
components in the OS ABI mechanism: sniffers and handlers.

   <p>A <dfn>sniffer</dfn> examines a file matching a BFD architecture/flavour pair
(the architecture may be wildcarded) in an attempt to determine the
OS ABI of that file.  Sniffers with a wildcarded architecture are considered
to be <dfn>generic</dfn>, while sniffers for a specific architecture are
considered to be <dfn>specific</dfn>.  A match from a specific sniffer
overrides a match from a generic sniffer.  Multiple sniffers for an
architecture/flavour may exist, in order to differentiate between two
different operating systems which use the same basic file format.  The
OS ABI framework provides a generic sniffer for ELF-format files which
examines the <code>EI_OSABI</code> field of the ELF header, as well as note
sections known to be used by several operating systems.

   <p><a name="index-fine_002dtuning-_0040code_007bgdbarch_007d-structure-216"></a>A <dfn>handler</dfn> is used to fine-tune the <code>gdbarch</code> structure for the
selected OS ABI.  There may be only one handler for a given OS ABI
for each BFD architecture.

   <p>The following OS ABI variants are defined in <samp><span class="file">defs.h</span></samp>:

     
<a name="index-GDB_005fOSABI_005fUNINITIALIZED-217"></a>
<dl><dt><code>GDB_OSABI_UNINITIALIZED</code><dd>Used for struct gdbarch_info if ABI is still uninitialized.

     <p><a name="index-GDB_005fOSABI_005fUNKNOWN-218"></a><br><dt><code>GDB_OSABI_UNKNOWN</code><dd>The ABI of the inferior is unknown.  The default <code>gdbarch</code>
settings for the architecture will be used.

     <p><a name="index-GDB_005fOSABI_005fSVR4-219"></a><br><dt><code>GDB_OSABI_SVR4</code><dd>UNIX System V Release 4.

     <p><a name="index-GDB_005fOSABI_005fHURD-220"></a><br><dt><code>GDB_OSABI_HURD</code><dd>GNU using the Hurd kernel.

     <p><a name="index-GDB_005fOSABI_005fSOLARIS-221"></a><br><dt><code>GDB_OSABI_SOLARIS</code><dd>Sun Solaris.

     <p><a name="index-GDB_005fOSABI_005fOSF1-222"></a><br><dt><code>GDB_OSABI_OSF1</code><dd>OSF/1, including Digital UNIX and Compaq Tru64 UNIX.

     <p><a name="index-GDB_005fOSABI_005fLINUX-223"></a><br><dt><code>GDB_OSABI_LINUX</code><dd>GNU using the Linux kernel.

     <p><a name="index-GDB_005fOSABI_005fFREEBSD_005fAOUT-224"></a><br><dt><code>GDB_OSABI_FREEBSD_AOUT</code><dd>FreeBSD using the <code>a.out</code> executable format.

     <p><a name="index-GDB_005fOSABI_005fFREEBSD_005fELF-225"></a><br><dt><code>GDB_OSABI_FREEBSD_ELF</code><dd>FreeBSD using the ELF executable format.

     <p><a name="index-GDB_005fOSABI_005fNETBSD_005fAOUT-226"></a><br><dt><code>GDB_OSABI_NETBSD_AOUT</code><dd>NetBSD using the <code>a.out</code> executable format.

     <p><a name="index-GDB_005fOSABI_005fNETBSD_005fELF-227"></a><br><dt><code>GDB_OSABI_NETBSD_ELF</code><dd>NetBSD using the ELF executable format.

     <p><a name="index-GDB_005fOSABI_005fOPENBSD_005fELF-228"></a><br><dt><code>GDB_OSABI_OPENBSD_ELF</code><dd>OpenBSD using the ELF executable format.

     <p><a name="index-GDB_005fOSABI_005fWINCE-229"></a><br><dt><code>GDB_OSABI_WINCE</code><dd>Windows CE.

     <p><a name="index-GDB_005fOSABI_005fGO32-230"></a><br><dt><code>GDB_OSABI_GO32</code><dd>DJGPP.

     <p><a name="index-GDB_005fOSABI_005fIRIX-231"></a><br><dt><code>GDB_OSABI_IRIX</code><dd>Irix.

     <p><a name="index-GDB_005fOSABI_005fINTERIX-232"></a><br><dt><code>GDB_OSABI_INTERIX</code><dd>Interix (Posix layer for MS-Windows systems).

     <p><a name="index-GDB_005fOSABI_005fHPUX_005fELF-233"></a><br><dt><code>GDB_OSABI_HPUX_ELF</code><dd>HP/UX using the ELF executable format.

     <p><a name="index-GDB_005fOSABI_005fHPUX_005fSOM-234"></a><br><dt><code>GDB_OSABI_HPUX_SOM</code><dd>HP/UX using the SOM executable format.

     <p><a name="index-GDB_005fOSABI_005fQNXNTO-235"></a><br><dt><code>GDB_OSABI_QNXNTO</code><dd>QNX Neutrino.

     <p><a name="index-GDB_005fOSABI_005fCYGWIN-236"></a><br><dt><code>GDB_OSABI_CYGWIN</code><dd>Cygwin.

     <p><a name="index-GDB_005fOSABI_005fAIX-237"></a><br><dt><code>GDB_OSABI_AIX</code><dd>AIX.

   </dl>

   <p>Here are the functions that make up the OS ABI framework:

<div class="defun">
&mdash; Function: const <b>char</b><var> *gdbarch_osabi_name </var>(<var>enum gdb_osabi osabi</var>)<var><a name="index-char-238"></a></var><br>
<blockquote><p>Return the name of the OS ABI corresponding to <var>osabi</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: void <b>gdbarch_register_osabi</b> (<var>enum bfd_architecture arch, unsigned long machine, enum gdb_osabi osabi, void </var>(<var>*init_osabi</var>)(<var>struct gdbarch_info info, struct gdbarch *gdbarch</var>))<var><a name="index-gdbarch_005fregister_005fosabi-239"></a></var><br>
<blockquote><p>Register the OS ABI handler specified by <var>init_osabi</var> for the
architecture, machine type and OS ABI specified by <var>arch</var>,
<var>machine</var> and <var>osabi</var>.  In most cases, a value of zero for the
machine type, which implies the architecture's default machine type,
will suffice. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: void <b>gdbarch_register_osabi_sniffer</b> (<var>enum bfd_architecture arch, enum bfd_flavour flavour, enum gdb_osabi </var>(<var>*sniffer</var>)(<var>bfd *abfd</var>))<var><a name="index-gdbarch_005fregister_005fosabi_005fsniffer-240"></a></var><br>
<blockquote><p>Register the OS ABI file sniffer specified by <var>sniffer</var> for the
BFD architecture/flavour pair specified by <var>arch</var> and <var>flavour</var>. 
If <var>arch</var> is <code>bfd_arch_unknown</code>, the sniffer is considered to
be generic, and is allowed to examine <var>flavour</var>-flavoured files for
any architecture. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: enum <b>gdb_osabi</b><var> gdbarch_lookup_osabi </var>(<var>bfd *abfd</var>)<var><a name="index-gdb_005fosabi-241"></a></var><br>
<blockquote><p>Examine the file described by <var>abfd</var> to determine its OS ABI. 
The value <code>GDB_OSABI_UNKNOWN</code> is returned if the OS ABI cannot
be determined. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: void <b>gdbarch_init_osabi</b> (<var>struct gdbarch info info, struct gdbarch *gdbarch, enum gdb_osabi osabi</var>)<var><a name="index-gdbarch_005finit_005fosabi-242"></a></var><br>
<blockquote><p>Invoke the OS ABI handler corresponding to <var>osabi</var> to fine-tune the
<code>gdbarch</code> structure specified by <var>gdbarch</var>.  If a handler
corresponding to <var>osabi</var> has not been registered for <var>gdbarch</var>'s
architecture, a warning will be issued and the debugging session will continue
with the defaults already established for <var>gdbarch</var>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: void <b>generic_elf_osabi_sniff_abi_tag_sections</b> (<var>bfd *abfd, asection *sect, void *obj</var>)<var><a name="index-generic_005felf_005fosabi_005fsniff_005fabi_005ftag_005fsections-243"></a></var><br>
<blockquote><p>Helper routine for ELF file sniffers.  Examine the file described by
<var>abfd</var> and look at ABI tag note sections to determine the OS ABI
from the note.  This function should be called via
<code>bfd_map_over_sections</code>. 
</p></blockquote></div>

<h3 class="section">9.2 Initializing a New Architecture</h3>

<p>Each <code>gdbarch</code> is associated with a single <span class="sc">bfd</span> architecture,
via a <code>bfd_arch_</code><var>arch</var> constant.  The <code>gdbarch</code> is
registered by a call to <code>register_gdbarch_init</code>, usually from
the file's <code>_initialize_</code><var>filename</var> routine, which will
be automatically called during <span class="sc">gdb</span> startup.  The arguments
are a <span class="sc">bfd</span> architecture constant and an initialization function.

   <p>The initialization function has this type:

<pre class="smallexample">     static struct gdbarch *
     <var>arch</var>_gdbarch_init (struct gdbarch_info <var>info</var>,
                              struct gdbarch_list *<var>arches</var>)
</pre>
   <p>The <var>info</var> argument contains parameters used to select the correct
architecture, and <var>arches</var> is a list of architectures which
have already been created with the same <code>bfd_arch_</code><var>arch</var>
value.

   <p>The initialization function should first make sure that <var>info</var>
is acceptable, and return <code>NULL</code> if it is not.  Then, it should
search through <var>arches</var> for an exact match to <var>info</var>, and
return one if found.  Lastly, if no exact match was found, it should
create a new architecture based on <var>info</var> and return it.

   <p>Only information in <var>info</var> should be used to choose the new
architecture.  Historically, <var>info</var> could be sparse, and
defaults would be collected from the first element on <var>arches</var>. 
However, <span class="sc">gdb</span> now fills in <var>info</var> more thoroughly,
so new <code>gdbarch</code> initialization functions should not take
defaults from <var>arches</var>.

<h3 class="section">9.3 Registers and Memory</h3>

<p><span class="sc">gdb</span>'s model of the target machine is rather simple. 
<span class="sc">gdb</span> assumes the machine includes a bank of registers and a
block of memory.  Each register may have a different size.

   <p><span class="sc">gdb</span> does not have a magical way to match up with the
compiler's idea of which registers are which; however, it is critical
that they do match up accurately.  The only way to make this work is
to get accurate information about the order that the compiler uses,
and to reflect that in the <code>REGISTER_NAME</code> and related macros.

   <p><span class="sc">gdb</span> can handle big-endian, little-endian, and bi-endian architectures.

<h3 class="section">9.4 Pointers Are Not Always Addresses</h3>

<p><a name="index-pointer-representation-244"></a><a name="index-address-representation-245"></a><a name="index-word_002daddressed-machines-246"></a><a name="index-separate-data-and-code-address-spaces-247"></a><a name="index-spaces_002c-separate-data-and-code-address-248"></a><a name="index-address-spaces_002c-separate-data-and-code-249"></a><a name="index-code-pointers_002c-word_002daddressed-250"></a><a name="index-converting-between-pointers-and-addresses-251"></a><a name="index-D10V-addresses-252"></a>
On almost all 32-bit architectures, the representation of a pointer is
indistinguishable from the representation of some fixed-length number
whose value is the byte address of the object pointed to.  On such
machines, the words &ldquo;pointer&rdquo; and &ldquo;address&rdquo; can be used interchangeably. 
However, architectures with smaller word sizes are often cramped for
address space, so they may choose a pointer representation that breaks this
identity, and allows a larger code address space.

   <p>For example, the Renesas D10V is a 16-bit VLIW processor whose
instructions are 32 bits long<a rel="footnote" href="#fn-1" name="fnd-1"><sup>1</sup></a>. 
If the D10V used ordinary byte addresses to refer to code locations,
then the processor would only be able to address 64kb of instructions. 
However, since instructions must be aligned on four-byte boundaries, the
low two bits of any valid instruction's byte address are always
zero&mdash;byte addresses waste two bits.  So instead of byte addresses,
the D10V uses word addresses&mdash;byte addresses shifted right two bits&mdash;to
refer to code.  Thus, the D10V can use 16-bit words to address 256kb of
code space.

   <p>However, this means that code pointers and data pointers have different
forms on the D10V.  The 16-bit word <code>0xC020</code> refers to byte address
<code>0xC020</code> when used as a data address, but refers to byte address
<code>0x30080</code> when used as a code address.

   <p>(The D10V also uses separate code and data address spaces, which also
affects the correspondence between pointers and addresses, but we're
going to ignore that here; this example is already too long.)

   <p>To cope with architectures like this&mdash;the D10V is not the only
one!&mdash;<span class="sc">gdb</span> tries to distinguish between <dfn>addresses</dfn>, which are
byte numbers, and <dfn>pointers</dfn>, which are the target's representation
of an address of a particular type of data.  In the example above,
<code>0xC020</code> is the pointer, which refers to one of the addresses
<code>0xC020</code> or <code>0x30080</code>, depending on the type imposed upon it. 
<span class="sc">gdb</span> provides functions for turning a pointer into an address
and vice versa, in the appropriate way for the current architecture.

   <p>Unfortunately, since addresses and pointers are identical on almost all
processors, this distinction tends to bit-rot pretty quickly.  Thus,
each time you port <span class="sc">gdb</span> to an architecture which does
distinguish between pointers and addresses, you'll probably need to
clean up some architecture-independent code.

   <p>Here are functions which convert between pointers and addresses:

<div class="defun">
&mdash; Function: CORE_ADDR <b>extract_typed_address</b> (<var>void *buf, struct type *type</var>)<var><a name="index-extract_005ftyped_005faddress-253"></a></var><br>
<blockquote><p>Treat the bytes at <var>buf</var> as a pointer or reference of type
<var>type</var>, and return the address it represents, in a manner
appropriate for the current architecture.  This yields an address
<span class="sc">gdb</span> can use to read target memory, disassemble, etc.  Note that
<var>buf</var> refers to a buffer in <span class="sc">gdb</span>'s memory, not the
inferior's.

        <p>For example, if the current architecture is the Intel x86, this function
extracts a little-endian integer of the appropriate length from
<var>buf</var> and returns it.  However, if the current architecture is the
D10V, this function will return a 16-bit integer extracted from
<var>buf</var>, multiplied by four if <var>type</var> is a pointer to a function.

        <p>If <var>type</var> is not a pointer or reference type, then this function
will signal an internal error. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: CORE_ADDR <b>store_typed_address</b> (<var>void *buf, struct type *type, CORE_ADDR addr</var>)<var><a name="index-store_005ftyped_005faddress-254"></a></var><br>
<blockquote><p>Store the address <var>addr</var> in <var>buf</var>, in the proper format for a
pointer of type <var>type</var> in the current architecture.  Note that
<var>buf</var> refers to a buffer in <span class="sc">gdb</span>'s memory, not the
inferior's.

        <p>For example, if the current architecture is the Intel x86, this function
stores <var>addr</var> unmodified as a little-endian integer of the
appropriate length in <var>buf</var>.  However, if the current architecture
is the D10V, this function divides <var>addr</var> by four if <var>type</var> is
a pointer to a function, and then stores it in <var>buf</var>.

        <p>If <var>type</var> is not a pointer or reference type, then this function
will signal an internal error. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: CORE_ADDR <b>value_as_address</b> (<var>struct value *val</var>)<var><a name="index-value_005fas_005faddress-255"></a></var><br>
<blockquote><p>Assuming that <var>val</var> is a pointer, return the address it represents,
as appropriate for the current architecture.

        <p>This function actually works on integral values, as well as pointers. 
For pointers, it performs architecture-specific conversions as
described above for <code>extract_typed_address</code>. 
</p></blockquote></div>

<div class="defun">
&mdash; Function: CORE_ADDR <b>value_from_pointer</b> (<var>struct type *type, CORE_ADDR addr</var>)<var><a name="index-value_005ffrom_005fpointer-256"></a></var><br>
<blockquote><p>Create and return a value representing a pointer of type <var>type</var> to
the address <var>addr</var>, as appropriate for the current architecture. 
This function performs architecture-specific conversions as described
above for <code>store_typed_address</code>. 
</p></blockquote></div>

   <p>Here are some macros which architectures can define to indicate the
relationship between pointers and addresses.  These have default
definitions, appropriate for architectures on which all pointers are
simple unsigned byte addresses.

<div class="defun">
&mdash; Target Macro: CORE_ADDR <b>POINTER_TO_ADDRESS</b> (<var>struct type *type, char *buf</var>)<var><a name="index-POINTER_005fTO_005fADDRESS-257"></a></var><br>
<blockquote><p>Assume that <var>buf</var> holds a pointer of type <var>type</var>, in the
appropriate format for the current architecture.  Return the byte
address the pointer refers to.

        <p>This function may safely assume that <var>type</var> is either a pointer or a
C<tt>++</tt> reference type. 
</p></blockquote></div>

<div class="defun">
&mdash; Target Macro: void <b>ADDRESS_TO_POINTER</b> (<var>struct type *type, char *buf, CORE_ADDR addr</var>)<var><a name="index-ADDRESS_005fTO_005fPOINTER-258"></a></var><br>
<blockquote><p>Store in <var>buf</var> a pointer of type <var>type</var> representing the address
<var>addr</var>, in the appropriate format for the current architecture.

        <p>This function may safely assume that <var>type</var> is either a pointer or a
C<tt>++</tt> reference type. 
</p></blockquote></div>

<h3 class="section">9.5 Address Classes</h3>

<p><a name="index-address-classes-259"></a><a name="index-DW_005fAT_005fbyte_005fsize-260"></a><a name="index-DW_005fAT_005faddress_005fclass-261"></a>
Sometimes information about different kinds of addresses is available
via the debug information.  For example, some programming environments
define addresses of several different sizes.  If the debug information
distinguishes these kinds of address classes through either the size
info (e.g, <code>DW_AT_byte_size</code> in DWARF&nbsp;2<!-- /@w -->) or through an explicit
address class attribute (e.g, <code>DW_AT_address_class</code> in DWARF&nbsp;2<!-- /@w -->), the
following macros should be defined in order to disambiguate these
types within <span class="sc">gdb</span> as well as provide the added information to
a <span class="sc">gdb</span> user when printing type expressions.

<div class="defun">
&mdash; Target Macro: int <b>ADDRESS_CLASS_TYPE_FLAGS</b> (<var>int byte_size, int dwarf2_addr_class</var>)<var><a name="index-ADDRESS_005fCLASS_005fTYPE_005fFLAGS-262"></a></var><br>
<blockquote><p>Returns the type flags needed to construct a pointer type whose size
is <var>byte_size</var> and whose address class is <var>dwarf2_addr_class</var>. 
This function is normally called from within a symbol reader.  See
<samp><span class="file">dwarf2read.c</span></samp>. 
</p></blockquote></div>

<div class="defun">
&mdash; Target Macro: char <b>*ADDRESS_CLASS_TYPE_FLAGS_TO_NAME</b> (<var>int type_flags</var>)<var><a name="index-g_t_002aADDRESS_005fCLASS_005fTYPE_005fFLAGS_005fTO_005fNAME-263"></a></var><br>
<blockquote><p>Given the type flags representing an address class qualifier, return
its name. 
</p></blockquote></div>

<div class="defun">
&mdash; Target Macro: int <b>ADDRESS_CLASS_NAME_to_TYPE_FLAGS</b> (<var>int name, int *vartype_flags_ptr</var>)<var><a name="index-ADDRESS_005fCLASS_005fNAME_005fto_005fTYPE_005fFLAGS-264"></a></var><br>
<blockquote><p>Given an address qualifier name, set the <code>int</code> referenced by <var>type_flags_ptr</var> to the type flags
for that address class qualifier. 
</p></blockquote></div>

   <p>Since the need for address classes is rather rare, none of
the address class macros defined by default.  Predicate
macros are provided to detect when they are defined.

   <p>Consider a hypothetical architecture in which addresses are normally
32-bits wide, but 16-bit addresses are also supported.  Furthermore,
suppose that the DWARF&nbsp;2<!-- /@w --> information for this architecture simply
uses a <code>DW_AT_byte_size</code> value of 2 to indicate the use of one
of these "short" pointers.  The following functions could be defined
to implement the address class macros:

<pre class="smallexample">     somearch_address_class_type_flags (int byte_size,
                                        int dwarf2_addr_class)
     {
       if (byte_size == 2)
         return TYPE_FLAG_ADDRESS_CLASS_1;
       else
         return 0;
     }
     
     static char *
     somearch_address_class_type_flags_to_name (int type_flags)
     {
       if (type_flags &amp; TYPE_FLAG_ADDRESS_CLASS_1)
         return "short";
       else
         return NULL;
     }
     
     int
     somearch_address_class_name_to_type_flags (char *name,
                                                int *type_flags_ptr)
     {
       if (strcmp (name, "short") == 0)
         {
           *type_flags_ptr = TYPE_FLAG_ADDRESS_CLASS_1;
           return 1;
         }
       else
         return 0;
     }
</pre>
   <p>The qualifier <code>@short</code> is used in <span class="sc">gdb</span>'s type expressions
to indicate the presence of one of these "short" pointers.  E.g, if
the debug information indicates that <code>short_ptr_var</code> is one of these
short pointers, <span class="sc">gdb</span> might show the following behavior:

<pre class="smallexample">     (gdb) ptype short_ptr_var
     type = int * @short
</pre>
   <h3 class="section">9.6 Raw and Virtual Register Representations</h3>

<p><a name="index-raw-register-representation-265"></a><a name="index-virtual-register-representation-266"></a><a name="index-representations_002c-raw-and-virtual-registers-267"></a>
<em>Maintainer note: This section is pretty much obsolete.  The
functionality described here has largely been replaced by
pseudo-registers and the mechanisms described in <a href="Target-Architecture-Definition.html#Target-Architecture-Definition">Using Different Register and Memory Data Representations</a>.  See also <a href="http://www.gnu.org/software/gdb/bugs/">Bug Tracking Database</a> and
<a href="http://sources.redhat.com/gdb/current/ari/">ARI Index</a> for more
up-to-date information.</em>

   <p>Some architectures use one representation for a value when it lives in a
register, but use a different representation when it lives in memory. 
In <span class="sc">gdb</span>'s terminology, the <dfn>raw</dfn> representation is the one used in
the target registers, and the <dfn>virtual</dfn> representation is the one
used in memory, and within <span class="sc">gdb</span> <code>struct value</code> objects.

   <p><em>Maintainer note: Notice that the same mechanism is being used to
both convert a register to a </em><code>struct value</code><em> and alternative
register forms.</em>

   <p>For almost all data types on almost all architectures, the virtual and
raw representations are identical, and no special handling is needed. 
However, they do occasionally differ.  For example:

     <ul>
<li>The x86 architecture supports an 80-bit <code>long double</code> type.  However, when
we store those values in memory, they occupy twelve bytes: the
floating-point number occupies the first ten, and the final two bytes
are unused.  This keeps the values aligned on four-byte boundaries,
allowing more efficient access.  Thus, the x86 80-bit floating-point
type is the raw representation, and the twelve-byte loosely-packed
arrangement is the virtual representation.

     <li>Some 64-bit MIPS targets present 32-bit registers to <span class="sc">gdb</span> as 64-bit
registers, with garbage in their upper bits.  <span class="sc">gdb</span> ignores the top 32
bits.  Thus, the 64-bit form, with garbage in the upper 32 bits, is the
raw representation, and the trimmed 32-bit representation is the
virtual representation. 
</ul>

   <p>In general, the raw representation is determined by the architecture, or
<span class="sc">gdb</span>'s interface to the architecture, while the virtual representation
can be chosen for <span class="sc">gdb</span>'s convenience.  <span class="sc">gdb</span>'s register file,
<code>registers</code>, holds the register contents in raw format, and the
<span class="sc">gdb</span> remote protocol transmits register values in raw format.

   <p>Your architecture may define the following macros to request
conversions between the raw and virtual format:

<div class="defun">
&mdash; Target Macro: int <b>REGISTER_CONVERTIBLE</b> (<var>int reg</var>)<var><a name="index-REGISTER_005fCONVERTIBLE-268"></a></var><br>
<blockquote><p>Return non-zero if register number <var>reg</var>'s value needs different raw
and virtual formats.

        <p>You should not use <code>REGISTER_CONVERT_TO_VIRTUAL</code> for a register
unless this macro returns a non-zero value for that register. 
</p></blockquote></div>

<div class="defun">
&mdash; Target Macro: int <b>DEPRECATED_REGISTER_RAW_SIZE</b> (<var>int reg</var>)<var><a name="index-DEPRECATED_005fREGISTER_005fRAW_005fSIZE-269"></a></var><br>
<blockquote><p>The size of register number <var>reg</var>'s raw value.  This is the number
of bytes the register will occupy in <code>registers</code>, or in a <span class="sc">gdb</span>
remote protocol packet. 
</p></blockquote></div>

<div class="defun">
&mdash; Target Macro: int <b>DEPRECATED_REGISTER_VIRTUAL_SIZE</b> (<var>int reg</var>)<var><a name="index-DEPRECATED_005fREGISTER_005fVIRTUAL_005fSIZE-270"></a></var><br>
<blockquote><p>The size of register number <var>reg</var>'s value, in its virtual format. 
This is the size a <code>struct value</code>'s buffer will have, holding that
register's value. 
</p></blockquote></div>

<div class="defun">
&mdash; Target Macro: struct <b>type</b><var> *DEPRECATED_REGISTER_VIRTUAL_TYPE </var>(<var>int reg</var>)<var><a name="index-type-271"></a></var><br>
<blockquote><p>This is the type of the virtual representation of register number
<var>reg</var>.  Note that there is no need for a macro giving a type for the
register's raw form; once the register's value has been obtained, <span class="sc">gdb</span>
always uses the virtual form. 
</p></blockquote></div>

<div class="defun">
&mdash; Target Macro: void <b>REGISTER_CONVERT_TO_VIRTUAL</b> (<var>int reg, struct type *type, char *from, char *to</var>)<var><a name="index-REGISTER_005fCONVERT_005fTO_005fVIRTUAL-272"></a></var><br>
<blockquote><p>Convert the value of register number <var>reg</var> to <var>type</var>, which
should always be <code>DEPRECATED_REGISTER_VIRTUAL_TYPE (</code><var>reg</var><code>)</code>.  The buffer
at <var>from</var> holds the register's value in raw format; the macro should
convert the value to virtual format, and place it at <var>to</var>.

        <p>Note that <code>REGISTER_CONVERT_TO_VIRTUAL</code> and
<code>REGISTER_CONVERT_TO_RAW</code> take their <var>reg</var> and <var>type</var>
arguments in different orders.

        <p>You should only use <code>REGISTER_CONVERT_TO_VIRTUAL</code> with registers
for which the <code>REGISTER_CONVERTIBLE</code> macro returns a non-zero
value. 
</p></blockquote></div>

<div class="defun">
&mdash; Target Macro: void <b>REGISTER_CONVERT_TO_RAW</b> (<var>struct type *type, int reg, char *from, char *to</var>)<var><a name="index-REGISTER_005fCONVERT_005fTO_005fRAW-273"></a></var><br>
<blockquote><p>Convert the value of register number <var>reg</var> to <var>type</var>, which
should always be <code>DEPRECATED_REGISTER_VIRTUAL_TYPE (</code><var>reg</var><code>)</code>.  The buffer
at <var>from</var> holds the register's value in raw format; the macro should
convert the value to virtual format, and place it at <var>to</var>.

        <p>Note that REGISTER_CONVERT_TO_VIRTUAL and REGISTER_CONVERT_TO_RAW take
their <var>reg</var> and <var>type</var> arguments in different orders. 
</p></blockquote></div>

<h3 class="section">9.7 Using Different Register and Memory Data Representations</h3>

<p><a name="index-register-representation-274"></a><a name="index-memory-representation-275"></a><a name="index-representations_002c-register-and-memory-276"></a><a name="index-register-data-formats_002c-converting-277"></a><a name="index-g_t_0040code_007bstruct-value_007d_002c-converting-register-contents-to-278"></a>
<em>Maintainer's note: The way GDB manipulates registers is undergoing
significant change.  Many of the macros and functions referred to in this
section are likely to be subject to further revision.  See
<a href="http://sources.redhat.com/gdb/current/ari/">A.R. Index</a> and
<a href="http://www.gnu.org/software/gdb/bugs">Bug Tracking Database</a> for
further information.  cagney/2002-05-06.</em>

   <p>Some architectures can represent a data object in a register using a
form that is different to the objects more normal memory representation. 
For example:

     <ul>
<li>The Alpha architecture can represent 32 bit integer values in
floating-point registers.

     <li>The x86 architecture supports 80-bit floating-point registers.  The
<code>long double</code> data type occupies 96 bits in memory but only 80 bits
when stored in a register.

   </ul>

   <p>In general, the register representation of a data type is determined by
the architecture, or <span class="sc">gdb</span>'s interface to the architecture, while
the memory representation is determined by the Application Binary
Interface.

   <p>For almost all data types on almost all architectures, the two
representations are identical, and no special handling is needed. 
However, they do occasionally differ.  Your architecture may define the
following macros to request conversions between the register and memory
representations of a data type:

<div class="defun">
&mdash; Target Macro: int <b>CONVERT_REGISTER_P</b> (<var>int reg</var>)<var><a name="index-CONVERT_005fREGISTER_005fP-279"></a></var><br>
<blockquote><p>Return non-zero if the representation of a data value stored in this
register may be different to the representation of that same data value
when stored in memory.

        <p>When non-zero, the macros <code>REGISTER_TO_VALUE</code> and
<code>VALUE_TO_REGISTER</code> are used to perform any necessary conversion. 
</p></blockquote></div>

<div class="defun">
&mdash; Target Macro: void <b>REGISTER_TO_VALUE</b> (<var>int reg, struct type *type, char *from, char *to</var>)<var><a name="index-REGISTER_005fTO_005fVALUE-280"></a></var><br>
<blockquote><p>Convert the value of register number <var>reg</var> to a data object of type
<var>type</var>.  The buffer at <var>from</var> holds the register's value in raw
format; the converted value should be placed in the buffer at <var>to</var>.

        <p>Note that <code>REGISTER_TO_VALUE</code> and <code>VALUE_TO_REGISTER</code> take
their <var>reg</var> and <var>type</var> arguments in different orders.

        <p>You should only use <code>REGISTER_TO_VALUE</code> with registers for which
the <code>CONVERT_REGISTER_P</code> macro returns a non-zero value. 
</p></blockquote></div>

<div class="defun">
&mdash; Target Macro: void <b>VALUE_TO_REGISTER</b> (<var>struct type *type, int reg, char *from, char *to</var>)<var><a name="index-VALUE_005fTO_005fREGISTER-281"></a></var><br>
<blockquote><p>Convert a data value of type <var>type</var> to register number <var>reg</var>'
raw format.

        <p>Note that <code>REGISTER_TO_VALUE</code> and <code>VALUE_TO_REGISTER</code> take
their <var>reg</var> and <var>type</var> arguments in different orders.

        <p>You should only use <code>VALUE_TO_REGISTER</code> with registers for which
the <code>CONVERT_REGISTER_P</code> macro returns a non-zero value. 
</p></blockquote></div>

<div class="defun">
&mdash; Target Macro: void <b>REGISTER_CONVERT_TO_TYPE</b> (<var>int regnum, struct type *type, char *buf</var>)<var><a name="index-REGISTER_005fCONVERT_005fTO_005fTYPE-282"></a></var><br>
<blockquote><p>See <samp><span class="file">mips-tdep.c</span></samp>.  It does not do what you want. 
</p></blockquote></div>

<h3 class="section">9.8 Frame Interpretation</h3>

<h3 class="section">9.9 Inferior Call Setup</h3>

<h3 class="section">9.10 Compiler Characteristics</h3>

<h3 class="section">9.11 Target Conditionals</h3>

<p>This section describes the macros that you can use to define the target
machine.

     <dl>
<dt><code>ADDR_BITS_REMOVE (addr)</code><dd><a name="index-ADDR_005fBITS_005fREMOVE-283"></a>If a raw machine instruction address includes any bits that are not
really part of the address, then define this macro to expand into an
expression that zeroes those bits in <var>addr</var>.  This is only used for
addresses of instructions, and even then not in all contexts.

     <p>For example, the two low-order bits of the PC on the Hewlett-Packard PA
2.0 architecture contain the privilege level of the corresponding
instruction.  Since instructions must always be aligned on four-byte
boundaries, the processor masks out these bits to generate the actual
address of the instruction.  ADDR_BITS_REMOVE should filter out these
bits with an expression such as <code>((addr) &amp; ~3)</code>.

     <br><dt><code>ADDRESS_CLASS_NAME_TO_TYPE_FLAGS (</code><var>name</var><code>, </code><var>type_flags_ptr</var><code>)</code><dd><a name="index-ADDRESS_005fCLASS_005fNAME_005fTO_005fTYPE_005fFLAGS-284"></a>If <var>name</var> is a valid address class qualifier name, set the <code>int</code>
referenced by <var>type_flags_ptr</var> to the mask representing the qualifier
and return 1.  If <var>name</var> is not a valid address class qualifier name,
return 0.

     <p>The value for <var>type_flags_ptr</var> should be one of
<code>TYPE_FLAG_ADDRESS_CLASS_1</code>, <code>TYPE_FLAG_ADDRESS_CLASS_2</code>, or
possibly some combination of these values or'd together. 
See <a href="Target-Architecture-Definition.html#Target-Architecture-Definition">Address Classes</a>.

     <br><dt><code>ADDRESS_CLASS_NAME_TO_TYPE_FLAGS_P ()</code><dd><a name="index-ADDRESS_005fCLASS_005fNAME_005fTO_005fTYPE_005fFLAGS_005fP-285"></a>Predicate which indicates whether <code>ADDRESS_CLASS_NAME_TO_TYPE_FLAGS</code>
has been defined.

     <br><dt><code>ADDRESS_CLASS_TYPE_FLAGS (</code><var>byte_size</var><code>, </code><var>dwarf2_addr_class</var><code>)</code><dd><a name="index-ADDRESS_005fCLASS_005fTYPE_005fFLAGS-_0028_0040var_007bbyte_005fsize_007d_002c-_0040var_007bdwarf2_005faddr_005fclass_007d_0029-286"></a>Given a pointers byte size (as described by the debug information) and
the possible <code>DW_AT_address_class</code> value, return the type flags
used by <span class="sc">gdb</span> to represent this address class.  The value
returned should be one of <code>TYPE_FLAG_ADDRESS_CLASS_1</code>,
<code>TYPE_FLAG_ADDRESS_CLASS_2</code>, or possibly some combination of these
values or'd together. 
See <a href="Target-Architecture-Definition.html#Target-Architecture-Definition">Address Classes</a>.

     <br><dt><code>ADDRESS_CLASS_TYPE_FLAGS_P ()</code><dd><a name="index-ADDRESS_005fCLASS_005fTYPE_005fFLAGS_005fP-287"></a>Predicate which indicates whether <code>ADDRESS_CLASS_TYPE_FLAGS</code> has
been defined.

     <br><dt><code>ADDRESS_CLASS_TYPE_FLAGS_TO_NAME (</code><var>type_flags</var><code>)</code><dd><a name="index-ADDRESS_005fCLASS_005fTYPE_005fFLAGS_005fTO_005fNAME-288"></a>Return the name of the address class qualifier associated with the type
flags given by <var>type_flags</var>.

     <br><dt><code>ADDRESS_CLASS_TYPE_FLAGS_TO_NAME_P ()</code><dd><a name="index-ADDRESS_005fCLASS_005fTYPE_005fFLAGS_005fTO_005fNAME_005fP-289"></a>Predicate which indicates whether <code>ADDRESS_CLASS_TYPE_FLAGS_TO_NAME</code> has
been defined. 
See <a href="Target-Architecture-Definition.html#Target-Architecture-Definition">Address Classes</a>.

     <br><dt><code>ADDRESS_TO_POINTER (</code><var>type</var><code>, </code><var>buf</var><code>, </code><var>addr</var><code>)</code><dd><a name="index-ADDRESS_005fTO_005fPOINTER-290"></a>Store in <var>buf</var> a pointer of type <var>type</var> representing the address
<var>addr</var>, in the appropriate format for the current architecture. 
This macro may safely assume that <var>type</var> is either a pointer or a
C<tt>++</tt> reference type. 
See <a href="Target-Architecture-Definition.html#Target-Architecture-Definition">Pointers Are Not Always Addresses</a>.

     <br><dt><code>BELIEVE_PCC_PROMOTION</code><dd><a name="index-BELIEVE_005fPCC_005fPROMOTION-291"></a>Define if the compiler promotes a <code>short</code> or <code>char</code>
parameter to an <code>int</code>, but still reports the parameter as its
original type, rather than the promoted type.

     <br><dt><code>BITS_BIG_ENDIAN</code><dd><a name="index-BITS_005fBIG_005fENDIAN-292"></a>Define this if the numbering of bits in the targets does <strong>not</strong> match the
endianness of the target byte order.  A value of 1 means that the bits
are numbered in a big-endian bit order, 0 means little-endian.

     <br><dt><code>BREAKPOINT</code><dd><a name="index-BREAKPOINT-293"></a>This is the character array initializer for the bit pattern to put into
memory where a breakpoint is set.  Although it's common to use a trap
instruction for a breakpoint, it's not required; for instance, the bit
pattern could be an invalid instruction.  The breakpoint must be no
longer than the shortest instruction of the architecture.

     <p><code>BREAKPOINT</code> has been deprecated in favor of
<code>BREAKPOINT_FROM_PC</code>.

     <br><dt><code>BIG_BREAKPOINT</code><dt><code>LITTLE_BREAKPOINT</code><dd><a name="index-LITTLE_005fBREAKPOINT-294"></a><a name="index-BIG_005fBREAKPOINT-295"></a>Similar to BREAKPOINT, but used for bi-endian targets.

     <p><code>BIG_BREAKPOINT</code> and <code>LITTLE_BREAKPOINT</code> have been deprecated in
favor of <code>BREAKPOINT_FROM_PC</code>.

     <br><dt><code>BREAKPOINT_FROM_PC (</code><var>pcptr</var><code>, </code><var>lenptr</var><code>)</code><dd><a name="index-BREAKPOINT_005fFROM_005fPC-296"></a><a name="BREAKPOINT_005fFROM_005fPC"></a> Use the program counter to determine the
contents and size of a breakpoint instruction.  It returns a pointer to
a string of bytes that encode a breakpoint instruction, stores the
length of the string to <code>*</code><var>lenptr</var>, and adjusts the program
counter (if necessary) to point to the actual memory location where the
breakpoint should be inserted.

     <p>Although it is common to use a trap instruction for a breakpoint, it's
not required; for instance, the bit pattern could be an invalid
instruction.  The breakpoint must be no longer than the shortest
instruction of the architecture.

     <p>Replaces all the other <var>BREAKPOINT</var> macros.

     <br><dt><code>MEMORY_INSERT_BREAKPOINT (</code><var>bp_tgt</var><code>)</code><dt><code>MEMORY_REMOVE_BREAKPOINT (</code><var>bp_tgt</var><code>)</code><dd><a name="index-MEMORY_005fREMOVE_005fBREAKPOINT-297"></a><a name="index-MEMORY_005fINSERT_005fBREAKPOINT-298"></a>Insert or remove memory based breakpoints.  Reasonable defaults
(<code>default_memory_insert_breakpoint</code> and
<code>default_memory_remove_breakpoint</code> respectively) have been
provided so that it is not necessary to define these for most
architectures.  Architectures which may want to define
<code>MEMORY_INSERT_BREAKPOINT</code> and <code>MEMORY_REMOVE_BREAKPOINT</code> will
likely have instructions that are oddly sized or are not stored in a
conventional manner.

     <p>It may also be desirable (from an efficiency standpoint) to define
custom breakpoint insertion and removal routines if
<code>BREAKPOINT_FROM_PC</code> needs to read the target's memory for some
reason.

     <br><dt><code>ADJUST_BREAKPOINT_ADDRESS (</code><var>address</var><code>)</code><dd><a name="index-ADJUST_005fBREAKPOINT_005fADDRESS-299"></a><a name="index-breakpoint-address-adjusted-300"></a>Given an address at which a breakpoint is desired, return a breakpoint
address adjusted to account for architectural constraints on
breakpoint placement.  This method is not needed by most targets.

     <p>The FR-V target (see <samp><span class="file">frv-tdep.c</span></samp>) requires this method. 
The FR-V is a VLIW architecture in which a number of RISC-like
instructions are grouped (packed) together into an aggregate
instruction or instruction bundle.  When the processor executes
one of these bundles, the component instructions are executed
in parallel.

     <p>In the course of optimization, the compiler may group instructions
from distinct source statements into the same bundle.  The line number
information associated with one of the latter statements will likely
refer to some instruction other than the first one in the bundle.  So,
if the user attempts to place a breakpoint on one of these latter
statements, <span class="sc">gdb</span> must be careful to <em>not</em> place the break
instruction on any instruction other than the first one in the bundle. 
(Remember though that the instructions within a bundle execute
in parallel, so the <em>first</em> instruction is the instruction
at the lowest address and has nothing to do with execution order.)

     <p>The FR-V's <code>ADJUST_BREAKPOINT_ADDRESS</code> method will adjust a
breakpoint's address by scanning backwards for the beginning of
the bundle, returning the address of the bundle.

     <p>Since the adjustment of a breakpoint may significantly alter a user's
expectation, <span class="sc">gdb</span> prints a warning when an adjusted breakpoint
is initially set and each time that that breakpoint is hit.

     <br><dt><code>CALL_DUMMY_LOCATION</code><dd><a name="index-CALL_005fDUMMY_005fLOCATION-301"></a>See the file <samp><span class="file">inferior.h</span></samp>.

     <p>This method has been replaced by <code>push_dummy_code</code>
(see <a href="push_005fdummy_005fcode.html#push_005fdummy_005fcode">push_dummy_code</a>).

     <br><dt><code>CANNOT_FETCH_REGISTER (</code><var>regno</var><code>)</code><dd><a name="index-CANNOT_005fFETCH_005fREGISTER-302"></a>A C expression that should be nonzero if <var>regno</var> cannot be fetched
from an inferior process.  This is only relevant if
<code>FETCH_INFERIOR_REGISTERS</code> is not defined.

     <br><dt><code>CANNOT_STORE_REGISTER (</code><var>regno</var><code>)</code><dd><a name="index-CANNOT_005fSTORE_005fREGISTER-303"></a>A C expression that should be nonzero if <var>regno</var> should not be
written to the target.  This is often the case for program counters,
status words, and other special registers.  If this is not defined,
<span class="sc">gdb</span> will assume that all registers may be written.

     <br><dt><code>int CONVERT_REGISTER_P(</code><var>regnum</var><code>)</code><dd><a name="index-CONVERT_005fREGISTER_005fP-304"></a>Return non-zero if register <var>regnum</var> can represent data values in a
non-standard form. 
See <a href="Target-Architecture-Definition.html#Target-Architecture-Definition">Using Different Register and Memory Data Representations</a>.

     <br><dt><code>DECR_PC_AFTER_BREAK</code><dd><a name="index-DECR_005fPC_005fAFTER_005fBREAK-305"></a>Define this to be the amount by which to decrement the PC after the
program encounters a breakpoint.  This is often the number of bytes in
<code>BREAKPOINT</code>, though not always.  For most targets this value will be 0.

     <br><dt><code>DISABLE_UNSETTABLE_BREAK (</code><var>addr</var><code>)</code><dd><a name="index-DISABLE_005fUNSETTABLE_005fBREAK-306"></a>If defined, this should evaluate to 1 if <var>addr</var> is in a shared
library in which breakpoints cannot be set and so should be disabled.

     <br><dt><code>PRINT_FLOAT_INFO()</code><dd><a name="index-PRINT_005fFLOAT_005fINFO-307"></a>If defined, then the `<samp><span class="samp">info float</span></samp>' command will print information about
the processor's floating point unit.

     <br><dt><code>print_registers_info (</code><var>gdbarch</var><code>, </code><var>frame</var><code>, </code><var>regnum</var><code>, </code><var>all</var><code>)</code><dd><a name="index-print_005fregisters_005finfo-308"></a>If defined, pretty print the value of the register <var>regnum</var> for the
specified <var>frame</var>.  If the value of <var>regnum</var> is -1, pretty print
either all registers (<var>all</var> is non zero) or a select subset of
registers (<var>all</var> is zero).

     <p>The default method prints one register per line, and if <var>all</var> is
zero omits floating-point registers.

     <br><dt><code>PRINT_VECTOR_INFO()</code><dd><a name="index-PRINT_005fVECTOR_005fINFO-309"></a>If defined, then the `<samp><span class="samp">info vector</span></samp>' command will call this function
to print information about the processor's vector unit.

     <p>By default, the `<samp><span class="samp">info vector</span></samp>' command will print all vector
registers (the register's type having the vector attribute).

     <br><dt><code>DWARF_REG_TO_REGNUM</code><dd><a name="index-DWARF_005fREG_005fTO_005fREGNUM-310"></a>Convert DWARF register number into <span class="sc">gdb</span> regnum.  If not defined,
no conversion will be performed.

     <br><dt><code>DWARF2_REG_TO_REGNUM</code><dd><a name="index-DWARF2_005fREG_005fTO_005fREGNUM-311"></a>Convert DWARF2 register number into <span class="sc">gdb</span> regnum.  If not
defined, no conversion will be performed.

     <br><dt><code>ECOFF_REG_TO_REGNUM</code><dd><a name="index-ECOFF_005fREG_005fTO_005fREGNUM-312"></a>Convert ECOFF register number into <span class="sc">gdb</span> regnum.  If not defined,
no conversion will be performed.

     <br><dt><code>END_OF_TEXT_DEFAULT</code><dd><a name="index-END_005fOF_005fTEXT_005fDEFAULT-313"></a>This is an expression that should designate the end of the text section. 
<!-- (? FIXME ?) -->

     <br><dt><code>EXTRACT_RETURN_VALUE(</code><var>type</var><code>, </code><var>regbuf</var><code>, </code><var>valbuf</var><code>)</code><dd><a name="index-EXTRACT_005fRETURN_005fVALUE-314"></a>Define this to extract a function's return value of type <var>type</var> from
the raw register state <var>regbuf</var> and copy that, in virtual format,
into <var>valbuf</var>.

     <p>This method has been deprecated in favour of <code>gdbarch_return_value</code>
(see <a href="gdbarch_005freturn_005fvalue.html#gdbarch_005freturn_005fvalue">gdbarch_return_value</a>).

     <br><dt><code>DEPRECATED_EXTRACT_STRUCT_VALUE_ADDRESS(</code><var>regbuf</var><code>)</code><dd><a name="index-DEPRECATED_005fEXTRACT_005fSTRUCT_005fVALUE_005fADDRESS-315"></a><a name="DEPRECATED_005fEXTRACT_005fSTRUCT_005fVALUE_005fADDRESS"></a>
When defined, extract from the array <var>regbuf</var> (containing the raw
register state) the <code>CORE_ADDR</code> at which a function should return
its structure value.

     <p>See <a href="gdbarch_005freturn_005fvalue.html#gdbarch_005freturn_005fvalue">gdbarch_return_value</a>.

     <br><dt><code>DEPRECATED_EXTRACT_STRUCT_VALUE_ADDRESS_P()</code><dd><a name="index-DEPRECATED_005fEXTRACT_005fSTRUCT_005fVALUE_005fADDRESS_005fP-316"></a>Predicate for <code>DEPRECATED_EXTRACT_STRUCT_VALUE_ADDRESS</code>.

     <br><dt><code>DEPRECATED_FP_REGNUM</code><dd><a name="index-DEPRECATED_005fFP_005fREGNUM-317"></a>If the virtual frame pointer is kept in a register, then define this
macro to be the number (greater than or equal to zero) of that register.

     <p>This should only need to be defined if <code>DEPRECATED_TARGET_READ_FP</code>
is not defined.

     <br><dt><code>DEPRECATED_FRAMELESS_FUNCTION_INVOCATION(</code><var>fi</var><code>)</code><dd><a name="index-DEPRECATED_005fFRAMELESS_005fFUNCTION_005fINVOCATION-318"></a>Define this to an expression that returns 1 if the function invocation
represented by <var>fi</var> does not have a stack frame associated with it. 
Otherwise return 0.

     <br><dt><code>frame_align (</code><var>address</var><code>)</code><dd><a name="frame_005falign"></a>
<a name="index-frame_005falign-319"></a>Define this to adjust <var>address</var> so that it meets the alignment
requirements for the start of a new stack frame.  A stack frame's
alignment requirements are typically stronger than a target processors
stack alignment requirements (see <a href="DEPRECATED_005fSTACK_005fALIGN.html#DEPRECATED_005fSTACK_005fALIGN">DEPRECATED_STACK_ALIGN</a>).

     <p>This function is used to ensure that, when creating a dummy frame, both
the initial stack pointer and (if needed) the address of the return
value are correctly aligned.

     <p>Unlike <code>DEPRECATED_STACK_ALIGN</code>, this function always adjusts the
address in the direction of stack growth.

     <p>By default, no frame based stack alignment is performed.

     <br><dt><code>int frame_red_zone_size</code><dd>
The number of bytes, beyond the innermost-stack-address, reserved by the
<span class="sc">abi</span>.  A function is permitted to use this scratch area (instead of
allocating extra stack space).

     <p>When performing an inferior function call, to ensure that it does not
modify this area, <span class="sc">gdb</span> adjusts the innermost-stack-address by
<var>frame_red_zone_size</var> bytes before pushing parameters onto the
stack.

     <p>By default, zero bytes are allocated.  The value must be aligned
(see <a href="frame_005falign.html#frame_005falign">frame_align</a>).

     <p>The <span class="sc">amd64</span> (nee x86-64) <span class="sc">abi</span> documentation refers to the
<em>red zone</em> when describing this scratch area. 
<a name="index-red-zone-320"></a>
<br><dt><code>DEPRECATED_FRAME_CHAIN(</code><var>frame</var><code>)</code><dd><a name="index-DEPRECATED_005fFRAME_005fCHAIN-321"></a>Given <var>frame</var>, return a pointer to the calling frame.

     <br><dt><code>DEPRECATED_FRAME_CHAIN_VALID(</code><var>chain</var><code>, </code><var>thisframe</var><code>)</code><dd><a name="index-DEPRECATED_005fFRAME_005fCHAIN_005fVALID-322"></a>Define this to be an expression that returns zero if the given frame is an
outermost frame, with no caller, and nonzero otherwise.  Most normal
situations can be handled without defining this macro, including <code>NULL</code>
chain pointers, dummy frames, and frames whose PC values are inside the
startup file (e.g. <samp><span class="file">crt0.o</span></samp>), inside <code>main</code>, or inside
<code>_start</code>.

     <br><dt><code>DEPRECATED_FRAME_INIT_SAVED_REGS(</code><var>frame</var><code>)</code><dd><a name="index-DEPRECATED_005fFRAME_005fINIT_005fSAVED_005fREGS-323"></a>See <samp><span class="file">frame.h</span></samp>.  Determines the address of all registers in the
current stack frame storing each in <code>frame-&gt;saved_regs</code>.  Space for
<code>frame-&gt;saved_regs</code> shall be allocated by
<code>DEPRECATED_FRAME_INIT_SAVED_REGS</code> using
<code>frame_saved_regs_zalloc</code>.

     <p><code>FRAME_FIND_SAVED_REGS</code> is deprecated.

     <br><dt><code>FRAME_NUM_ARGS (</code><var>fi</var><code>)</code><dd><a name="index-FRAME_005fNUM_005fARGS-324"></a>For the frame described by <var>fi</var> return the number of arguments that
are being passed.  If the number of arguments is not known, return
<code>-1</code>.

     <br><dt><code>DEPRECATED_FRAME_SAVED_PC(</code><var>frame</var><code>)</code><dd><a name="index-DEPRECATED_005fFRAME_005fSAVED_005fPC-325"></a><a name="DEPRECATED_005fFRAME_005fSAVED_005fPC"></a> Given <var>frame</var>, return the pc
saved there.  This is the return address.

     <p>This method is deprecated. See <a href="unwind_005fpc.html#unwind_005fpc">unwind_pc</a>.

     <br><dt><code>CORE_ADDR unwind_pc (struct frame_info *</code><var>this_frame</var><code>)</code><dd><a name="index-unwind_005fpc-326"></a><a name="unwind_005fpc"></a> Return the instruction address, in <var>this_frame</var>'s
caller, at which execution will resume after <var>this_frame</var> returns. 
This is commonly referred to as the return address.

     <p>The implementation, which must be frame agnostic (work with any frame),
is typically no more than:

     <pre class="smallexample">          ULONGEST pc;
          frame_unwind_unsigned_register (this_frame, D10V_PC_REGNUM, &amp;pc);
          return d10v_make_iaddr (pc);
     </pre>
     <p class="noindent">See <a href="DEPRECATED_005fFRAME_005fSAVED_005fPC.html#DEPRECATED_005fFRAME_005fSAVED_005fPC">DEPRECATED_FRAME_SAVED_PC</a>, which this method replaces.

     <br><dt><code>CORE_ADDR unwind_sp (struct frame_info *</code><var>this_frame</var><code>)</code><dd><a name="index-unwind_005fsp-327"></a><a name="unwind_005fsp"></a> Return the frame's inner most stack address.  This is
commonly referred to as the frame's <dfn>stack pointer</dfn>.

     <p>The implementation, which must be frame agnostic (work with any frame),
is typically no more than:

     <pre class="smallexample">          ULONGEST sp;
          frame_unwind_unsigned_register (this_frame, D10V_SP_REGNUM, &amp;sp);
          return d10v_make_daddr (sp);
     </pre>
     <p class="noindent">See <a href="TARGET_005fREAD_005fSP.html#TARGET_005fREAD_005fSP">TARGET_READ_SP</a>, which this method replaces.

     <br><dt><code>FUNCTION_EPILOGUE_SIZE</code><dd><a name="index-FUNCTION_005fEPILOGUE_005fSIZE-328"></a>For some COFF targets, the <code>x_sym.x_misc.x_fsize</code> field of the
function end symbol is 0.  For such targets, you must define
<code>FUNCTION_EPILOGUE_SIZE</code> to expand into the standard size of a
function's epilogue.

     <br><dt><code>DEPRECATED_FUNCTION_START_OFFSET</code><dd><a name="index-DEPRECATED_005fFUNCTION_005fSTART_005fOFFSET-329"></a>An integer, giving the offset in bytes from a function's address (as
used in the values of symbols, function pointers, etc.), and the
function's first genuine instruction.

     <p>This is zero on almost all machines: the function's address is usually
the address of its first instruction.  However, on the VAX, for
example, each function starts with two bytes containing a bitmask
indicating which registers to save upon entry to the function.  The
VAX <code>call</code> instructions check this value, and save the
appropriate registers automatically.  Thus, since the offset from the
function's address to its first instruction is two bytes,
<code>DEPRECATED_FUNCTION_START_OFFSET</code> would be 2 on the VAX.

     <br><dt><code>GCC_COMPILED_FLAG_SYMBOL</code><dt><code>GCC2_COMPILED_FLAG_SYMBOL</code><dd><a name="index-GCC2_005fCOMPILED_005fFLAG_005fSYMBOL-330"></a><a name="index-GCC_005fCOMPILED_005fFLAG_005fSYMBOL-331"></a>If defined, these are the names of the symbols that <span class="sc">gdb</span> will
look for to detect that GCC compiled the file.  The default symbols
are <code>gcc_compiled.</code> and <code>gcc2_compiled.</code>,
respectively.  (Currently only defined for the Delta 68.)

     <br><dt><span class="sc">gdb</span><code>_MULTI_ARCH</code><dd><a name="index-g_t_0040value_007bGDBN_007d_005fMULTI_005fARCH-332"></a>If defined and non-zero, enables support for multiple architectures
within <span class="sc">gdb</span>.

     <p>This support can be enabled at two levels.  At level one, only
definitions for previously undefined macros are provided; at level two,
a multi-arch definition of all architecture dependent macros will be
defined.

     <br><dt><span class="sc">gdb</span><code>_TARGET_IS_HPPA</code><dd><a name="index-g_t_0040value_007bGDBN_007d_005fTARGET_005fIS_005fHPPA-333"></a>This determines whether horrible kludge code in <samp><span class="file">dbxread.c</span></samp> and
<samp><span class="file">partial-stab.h</span></samp> is used to mangle multiple-symbol-table files from
HPPA's.  This should all be ripped out, and a scheme like <samp><span class="file">elfread.c</span></samp>
used instead.

     <br><dt><code>GET_LONGJMP_TARGET</code><dd><a name="index-GET_005fLONGJMP_005fTARGET-334"></a>For most machines, this is a target-dependent parameter.  On the
DECstation and the Iris, this is a native-dependent parameter, since
the header file <samp><span class="file">setjmp.h</span></samp> is needed to define it.

     <p>This macro determines the target PC address that <code>longjmp</code> will jump to,
assuming that we have just stopped at a <code>longjmp</code> breakpoint.  It takes a
<code>CORE_ADDR *</code> as argument, and stores the target PC value through this
pointer.  It examines the current state of the machine as needed.

     <br><dt><code>DEPRECATED_GET_SAVED_REGISTER</code><dd><a name="index-DEPRECATED_005fGET_005fSAVED_005fREGISTER-335"></a>Define this if you need to supply your own definition for the function
<code>DEPRECATED_GET_SAVED_REGISTER</code>.

     <br><dt><code>DEPRECATED_IBM6000_TARGET</code><dd><a name="index-DEPRECATED_005fIBM6000_005fTARGET-336"></a>Shows that we are configured for an IBM RS/6000 system.  This
conditional should be eliminated (FIXME) and replaced by
feature-specific macros.  It was introduced in a haste and we are
repenting at leisure.

     <br><dt><code>I386_USE_GENERIC_WATCHPOINTS</code><dd>An x86-based target can define this to use the generic x86 watchpoint
support; see <a href="Algorithms.html#Algorithms">I386_USE_GENERIC_WATCHPOINTS</a>.

     <br><dt><code>SYMBOLS_CAN_START_WITH_DOLLAR</code><dd><a name="index-SYMBOLS_005fCAN_005fSTART_005fWITH_005fDOLLAR-337"></a>Some systems have routines whose names start with `<samp><span class="samp">$</span></samp>'.  Giving this
macro a non-zero value tells <span class="sc">gdb</span>'s expression parser to check for such
routines when parsing tokens that begin with `<samp><span class="samp">$</span></samp>'.

     <p>On HP-UX, certain system routines (millicode) have names beginning with
`<samp><span class="samp">$</span></samp>' or `<samp><span class="samp">$$</span></samp>'.  For example, <code>$$dyncall</code> is a millicode
routine that handles inter-space procedure calls on PA-RISC.

     <br><dt><code>DEPRECATED_INIT_EXTRA_FRAME_INFO (</code><var>fromleaf</var><code>, </code><var>frame</var><code>)</code><dd><a name="index-DEPRECATED_005fINIT_005fEXTRA_005fFRAME_005fINFO-338"></a>If additional information about the frame is required this should be
stored in <code>frame-&gt;extra_info</code>.  Space for <code>frame-&gt;extra_info</code>
is allocated using <code>frame_extra_info_zalloc</code>.

     <br><dt><code>DEPRECATED_INIT_FRAME_PC (</code><var>fromleaf</var><code>, </code><var>prev</var><code>)</code><dd><a name="index-DEPRECATED_005fINIT_005fFRAME_005fPC-339"></a>This is a C statement that sets the pc of the frame pointed to by
<var>prev</var>.  [By default...]

     <br><dt><code>INNER_THAN (</code><var>lhs</var><code>, </code><var>rhs</var><code>)</code><dd><a name="index-INNER_005fTHAN-340"></a>Returns non-zero if stack address <var>lhs</var> is inner than (nearer to the
stack top) stack address <var>rhs</var>. Define this as <code>lhs &lt; rhs</code> if
the target's stack grows downward in memory, or <code>lhs &gt; rsh</code> if the
stack grows upward.

     <br><dt><code>gdbarch_in_function_epilogue_p (</code><var>gdbarch</var><code>, </code><var>pc</var><code>)</code><dd><a name="index-gdbarch_005fin_005ffunction_005fepilogue_005fp-341"></a>Returns non-zero if the given <var>pc</var> is in the epilogue of a function. 
The epilogue of a function is defined as the part of a function where
the stack frame of the function already has been destroyed up to the
final `return from function call' instruction.

     <br><dt><code>DEPRECATED_SIGTRAMP_START (</code><var>pc</var><code>)</code><dd><a name="index-DEPRECATED_005fSIGTRAMP_005fSTART-342"></a><dt><code>DEPRECATED_SIGTRAMP_END (</code><var>pc</var><code>)</code><dd><a name="index-DEPRECATED_005fSIGTRAMP_005fEND-343"></a>Define these to be the start and end address of the <code>sigtramp</code> for the
given <var>pc</var>.  On machines where the address is just a compile time
constant, the macro expansion will typically just ignore the supplied
<var>pc</var>.

     <br><dt><code>IN_SOLIB_CALL_TRAMPOLINE (</code><var>pc</var><code>, </code><var>name</var><code>)</code><dd><a name="index-IN_005fSOLIB_005fCALL_005fTRAMPOLINE-344"></a>Define this to evaluate to nonzero if the program is stopped in the
trampoline that connects to a shared library.

     <br><dt><code>IN_SOLIB_RETURN_TRAMPOLINE (</code><var>pc</var><code>, </code><var>name</var><code>)</code><dd><a name="index-IN_005fSOLIB_005fRETURN_005fTRAMPOLINE-345"></a>Define this to evaluate to nonzero if the program is stopped in the
trampoline that returns from a shared library.

     <br><dt><code>IN_SOLIB_DYNSYM_RESOLVE_CODE (</code><var>pc</var><code>)</code><dd><a name="index-IN_005fSOLIB_005fDYNSYM_005fRESOLVE_005fCODE-346"></a>Define this to evaluate to nonzero if the program is stopped in the
dynamic linker.

     <br><dt><code>SKIP_SOLIB_RESOLVER (</code><var>pc</var><code>)</code><dd><a name="index-SKIP_005fSOLIB_005fRESOLVER-347"></a>Define this to evaluate to the (nonzero) address at which execution
should continue to get past the dynamic linker's symbol resolution
function.  A zero value indicates that it is not important or necessary
to set a breakpoint to get through the dynamic linker and that single
stepping will suffice.

     <br><dt><code>INTEGER_TO_ADDRESS (</code><var>type</var><code>, </code><var>buf</var><code>)</code><dd><a name="index-INTEGER_005fTO_005fADDRESS-348"></a><a name="index-converting-integers-to-addresses-349"></a>Define this when the architecture needs to handle non-pointer to address
conversions specially.  Converts that value to an address according to
the current architectures conventions.

     <p><em>Pragmatics: When the user copies a well defined expression from
their source code and passes it, as a parameter, to </em><span class="sc">gdb</span><em>'s
</em><code>print</code><em> command, they should get the same value as would have been
computed by the target program.  Any deviation from this rule can cause
major confusion and annoyance, and needs to be justified carefully.  In
other words, </em><span class="sc">gdb</span><em> doesn't really have the freedom to do these
conversions in clever and useful ways.  It has, however, been pointed
out that users aren't complaining about how </em><span class="sc">gdb</span><em> casts integers
to pointers; they are complaining that they can't take an address from a
disassembly listing and give it to </em><code>x/i</code><em>.  Adding an architecture
method like </em><code>INTEGER_TO_ADDRESS</code><em> certainly makes it possible for
</em><span class="sc">gdb</span><em> to &ldquo;get it right&rdquo; in all circumstances.</em>

     <p>See <a href="Target-Architecture-Definition.html#Target-Architecture-Definition">Pointers Are Not Always Addresses</a>.

     <br><dt><code>NO_HIF_SUPPORT</code><dd><a name="index-NO_005fHIF_005fSUPPORT-350"></a>(Specific to the a29k.)

     <br><dt><code>POINTER_TO_ADDRESS (</code><var>type</var><code>, </code><var>buf</var><code>)</code><dd><a name="index-POINTER_005fTO_005fADDRESS-351"></a>Assume that <var>buf</var> holds a pointer of type <var>type</var>, in the
appropriate format for the current architecture.  Return the byte
address the pointer refers to. 
See <a href="Target-Architecture-Definition.html#Target-Architecture-Definition">Pointers Are Not Always Addresses</a>.

     <br><dt><code>REGISTER_CONVERTIBLE (</code><var>reg</var><code>)</code><dd><a name="index-REGISTER_005fCONVERTIBLE-352"></a>Return non-zero if <var>reg</var> uses different raw and virtual formats. 
See <a href="Target-Architecture-Definition.html#Target-Architecture-Definition">Raw and Virtual Register Representations</a>.

     <br><dt><code>REGISTER_TO_VALUE(</code><var>regnum</var><code>, </code><var>type</var><code>, </code><var>from</var><code>, </code><var>to</var><code>)</code><dd><a name="index-REGISTER_005fTO_005fVALUE-353"></a>Convert the raw contents of register <var>regnum</var> into a value of type
<var>type</var>. 
See <a href="Target-Architecture-Definition.html#Target-Architecture-Definition">Using Different Register and Memory Data Representations</a>.

     <br><dt><code>DEPRECATED_REGISTER_RAW_SIZE (</code><var>reg</var><code>)</code><dd><a name="index-DEPRECATED_005fREGISTER_005fRAW_005fSIZE-354"></a>Return the raw size of <var>reg</var>; defaults to the size of the register's
virtual type. 
See <a href="Target-Architecture-Definition.html#Target-Architecture-Definition">Raw and Virtual Register Representations</a>.

     <br><dt><code>register_reggroup_p (</code><var>gdbarch</var><code>, </code><var>regnum</var><code>, </code><var>reggroup</var><code>)</code><dd><a name="index-register_005freggroup_005fp-355"></a><a name="index-register-groups-356"></a>Return non-zero if register <var>regnum</var> is a member of the register
group <var>reggroup</var>.

     <p>By default, registers are grouped as follows:

          <dl>
<dt><code>float_reggroup</code><dd>Any register with a valid name and a floating-point type. 
<br><dt><code>vector_reggroup</code><dd>Any register with a valid name and a vector type. 
<br><dt><code>general_reggroup</code><dd>Any register with a valid name and a type other than vector or
floating-point.  `<samp><span class="samp">float_reggroup</span></samp>'. 
<br><dt><code>save_reggroup</code><dt><code>restore_reggroup</code><dt><code>all_reggroup</code><dd>Any register with a valid name. 
</dl>

     <br><dt><code>DEPRECATED_REGISTER_VIRTUAL_SIZE (</code><var>reg</var><code>)</code><dd><a name="index-DEPRECATED_005fREGISTER_005fVIRTUAL_005fSIZE-357"></a>Return the virtual size of <var>reg</var>; defaults to the size of the
register's virtual type. 
Return the virtual size of <var>reg</var>. 
See <a href="Target-Architecture-Definition.html#Target-Architecture-Definition">Raw and Virtual Register Representations</a>.

     <br><dt><code>DEPRECATED_REGISTER_VIRTUAL_TYPE (</code><var>reg</var><code>)</code><dd><a name="index-REGISTER_005fVIRTUAL_005fTYPE-358"></a>Return the virtual type of <var>reg</var>. 
See <a href="Target-Architecture-Definition.html#Target-Architecture-Definition">Raw and Virtual Register Representations</a>.

     <br><dt><code>struct type *register_type (</code><var>gdbarch</var><code>, </code><var>reg</var><code>)</code><dd><a name="index-register_005ftype-359"></a>If defined, return the type of register <var>reg</var>.  This function
supersedes <code>DEPRECATED_REGISTER_VIRTUAL_TYPE</code>.  See <a href="Target-Architecture-Definition.html#Target-Architecture-Definition">Raw and Virtual Register Representations</a>.

     <br><dt><code>REGISTER_CONVERT_TO_VIRTUAL(</code><var>reg</var><code>, </code><var>type</var><code>, </code><var>from</var><code>, </code><var>to</var><code>)</code><dd><a name="index-REGISTER_005fCONVERT_005fTO_005fVIRTUAL-360"></a>Convert the value of register <var>reg</var> from its raw form to its virtual
form. 
See <a href="Target-Architecture-Definition.html#Target-Architecture-Definition">Raw and Virtual Register Representations</a>.

     <br><dt><code>REGISTER_CONVERT_TO_RAW(</code><var>type</var><code>, </code><var>reg</var><code>, </code><var>from</var><code>, </code><var>to</var><code>)</code><dd><a name="index-REGISTER_005fCONVERT_005fTO_005fRAW-361"></a>Convert the value of register <var>reg</var> from its virtual form to its raw
form. 
See <a href="Target-Architecture-Definition.html#Target-Architecture-Definition">Raw and Virtual Register Representations</a>.

     <br><dt><code>const struct regset *regset_from_core_section (struct gdbarch * </code><var>gdbarch</var><code>, const char * </code><var>sect_name</var><code>, size_t </code><var>sect_size</var><code>)</code><dd><a name="index-regset_005ffrom_005fcore_005fsection-362"></a>Return the appropriate register set for a core file section with name
<var>sect_name</var> and size <var>sect_size</var>.

     <br><dt><code>SOFTWARE_SINGLE_STEP_P()</code><dd><a name="index-SOFTWARE_005fSINGLE_005fSTEP_005fP-363"></a>Define this as 1 if the target does not have a hardware single-step
mechanism.  The macro <code>SOFTWARE_SINGLE_STEP</code> must also be defined.

     <br><dt><code>SOFTWARE_SINGLE_STEP(</code><var>signal</var><code>, </code><var>insert_breakpoints_p</var><code>)</code><dd><a name="index-SOFTWARE_005fSINGLE_005fSTEP-364"></a>A function that inserts or removes (depending on
<var>insert_breakpoints_p</var>) breakpoints at each possible destinations of
the next instruction. See <samp><span class="file">sparc-tdep.c</span></samp> and <samp><span class="file">rs6000-tdep.c</span></samp>
for examples.

     <br><dt><code>SOFUN_ADDRESS_MAYBE_MISSING</code><dd><a name="index-SOFUN_005fADDRESS_005fMAYBE_005fMISSING-365"></a>Somebody clever observed that, the more actual addresses you have in the
debug information, the more time the linker has to spend relocating
them.  So whenever there's some other way the debugger could find the
address it needs, you should omit it from the debug info, to make
linking faster.

     <p><code>SOFUN_ADDRESS_MAYBE_MISSING</code> indicates that a particular set of
hacks of this sort are in use, affecting <code>N_SO</code> and <code>N_FUN</code>
entries in stabs-format debugging information.  <code>N_SO</code> stabs mark
the beginning and ending addresses of compilation units in the text
segment.  <code>N_FUN</code> stabs mark the starts and ends of functions.

     <p><code>SOFUN_ADDRESS_MAYBE_MISSING</code> means two things:

          <ul>
<li><code>N_FUN</code> stabs have an address of zero.  Instead, you should find the
addresses where the function starts by taking the function name from
the stab, and then looking that up in the minsyms (the
linker/assembler symbol table).  In other words, the stab has the
name, and the linker/assembler symbol table is the only place that carries
the address.

          <li><code>N_SO</code> stabs have an address of zero, too.  You just look at the
<code>N_FUN</code> stabs that appear before and after the <code>N_SO</code> stab,
and guess the starting and ending addresses of the compilation unit from
them. 
</ul>

     <br><dt><code>PC_LOAD_SEGMENT</code><dd><a name="index-PC_005fLOAD_005fSEGMENT-366"></a>If defined, print information about the load segment for the program
counter.  (Defined only for the RS/6000.)

     <br><dt><code>PC_REGNUM</code><dd><a name="index-PC_005fREGNUM-367"></a>If the program counter is kept in a register, then define this macro to
be the number (greater than or equal to zero) of that register.

     <p>This should only need to be defined if <code>TARGET_READ_PC</code> and
<code>TARGET_WRITE_PC</code> are not defined.

     <br><dt><code>PARM_BOUNDARY</code><dd><a name="index-PARM_005fBOUNDARY-368"></a>If non-zero, round arguments to a boundary of this many bits before
pushing them on the stack.

     <br><dt><code>stabs_argument_has_addr (</code><var>gdbarch</var><code>, </code><var>type</var><code>)</code><dd><a name="index-stabs_005fargument_005fhas_005faddr-369"></a><a name="index-DEPRECATED_005fREG_005fSTRUCT_005fHAS_005fADDR-370"></a><a name="stabs_005fargument_005fhas_005faddr"></a> Define this to return nonzero if a
function argument of type <var>type</var> is passed by reference instead of
value.

     <p>This method replaces <code>DEPRECATED_REG_STRUCT_HAS_ADDR</code>
(see <a href="DEPRECATED_005fREG_005fSTRUCT_005fHAS_005fADDR.html#DEPRECATED_005fREG_005fSTRUCT_005fHAS_005fADDR">DEPRECATED_REG_STRUCT_HAS_ADDR</a>).

     <br><dt><code>PROCESS_LINENUMBER_HOOK</code><dd><a name="index-PROCESS_005fLINENUMBER_005fHOOK-371"></a>A hook defined for XCOFF reading.

     <br><dt><code>PROLOGUE_FIRSTLINE_OVERLAP</code><dd><a name="index-PROLOGUE_005fFIRSTLINE_005fOVERLAP-372"></a>(Only used in unsupported Convex configuration.)

     <br><dt><code>PS_REGNUM</code><dd><a name="index-PS_005fREGNUM-373"></a>If defined, this is the number of the processor status register.  (This
definition is only used in generic code when parsing "$ps".)

     <br><dt><code>DEPRECATED_POP_FRAME</code><dd><a name="index-DEPRECATED_005fPOP_005fFRAME-374"></a><a name="index-frame_005fpop-375"></a>If defined, used by <code>frame_pop</code> to remove a stack frame.  This
method has been superseded by generic code.

     <br><dt><code>push_dummy_call (</code><var>gdbarch</var><code>, </code><var>function</var><code>, </code><var>regcache</var><code>, </code><var>pc_addr</var><code>, </code><var>nargs</var><code>, </code><var>args</var><code>, </code><var>sp</var><code>, </code><var>struct_return</var><code>, </code><var>struct_addr</var><code>)</code><dd><a name="index-push_005fdummy_005fcall-376"></a><a name="index-DEPRECATED_005fPUSH_005fARGUMENTS_002e-377"></a><a name="push_005fdummy_005fcall"></a> Define this to push the dummy frame's call to
the inferior function onto the stack.  In addition to pushing
<var>nargs</var>, the code should push <var>struct_addr</var> (when
<var>struct_return</var>), and the return address (<var>bp_addr</var>).

     <p><var>function</var> is a pointer to a <code>struct value</code>; on architectures that use
function descriptors, this contains the function descriptor value.

     <p>Returns the updated top-of-stack pointer.

     <p>This method replaces <code>DEPRECATED_PUSH_ARGUMENTS</code>.

     <br><dt><code>CORE_ADDR push_dummy_code (</code><var>gdbarch</var><code>, </code><var>sp</var><code>, </code><var>funaddr</var><code>, </code><var>using_gcc</var><code>, </code><var>args</var><code>, </code><var>nargs</var><code>, </code><var>value_type</var><code>, </code><var>real_pc</var><code>, </code><var>bp_addr</var><code>)</code><dd><a name="index-push_005fdummy_005fcode-378"></a><a name="push_005fdummy_005fcode"></a> Given a stack based call dummy, push the
instruction sequence (including space for a breakpoint) to which the
called function should return.

     <p>Set <var>bp_addr</var> to the address at which the breakpoint instruction
should be inserted, <var>real_pc</var> to the resume address when starting
the call sequence, and return the updated inner-most stack address.

     <p>By default, the stack is grown sufficient to hold a frame-aligned
(see <a href="frame_005falign.html#frame_005falign">frame_align</a>) breakpoint, <var>bp_addr</var> is set to the address
reserved for that breakpoint, and <var>real_pc</var> set to <var>funaddr</var>.

     <p>This method replaces <code>CALL_DUMMY_LOCATION</code>,
<code>DEPRECATED_REGISTER_SIZE</code>.

     <br><dt><code>REGISTER_NAME(</code><var>i</var><code>)</code><dd><a name="index-REGISTER_005fNAME-379"></a>Return the name of register <var>i</var> as a string.  May return <code>NULL</code>
or <code>NUL</code> to indicate that register <var>i</var> is not valid.

     <br><dt><code>DEPRECATED_REG_STRUCT_HAS_ADDR (</code><var>gcc_p</var><code>, </code><var>type</var><code>)</code><dd><a name="index-DEPRECATED_005fREG_005fSTRUCT_005fHAS_005fADDR-380"></a><a name="DEPRECATED_005fREG_005fSTRUCT_005fHAS_005fADDR"></a>Define this to return 1 if the
given type will be passed by pointer rather than directly.

     <p>This method has been replaced by <code>stabs_argument_has_addr</code>
(see <a href="stabs_005fargument_005fhas_005faddr.html#stabs_005fargument_005fhas_005faddr">stabs_argument_has_addr</a>).

     <br><dt><code>SAVE_DUMMY_FRAME_TOS (</code><var>sp</var><code>)</code><dd><a name="index-SAVE_005fDUMMY_005fFRAME_005fTOS-381"></a><a name="SAVE_005fDUMMY_005fFRAME_005fTOS"></a> Used in `<samp><span class="samp">call_function_by_hand</span></samp>' to
notify the target dependent code of the top-of-stack value that will be
passed to the inferior code.  This is the value of the <code>SP</code>
after both the dummy frame and space for parameters/results have been
allocated on the stack.  See <a href="unwind_005fdummy_005fid.html#unwind_005fdummy_005fid">unwind_dummy_id</a>.

     <br><dt><code>SDB_REG_TO_REGNUM</code><dd><a name="index-SDB_005fREG_005fTO_005fREGNUM-382"></a>Define this to convert sdb register numbers into <span class="sc">gdb</span> regnums.  If not
defined, no conversion will be done.

     <br><dt><code>enum return_value_convention gdbarch_return_value (struct gdbarch *</code><var>gdbarch</var><code>, struct type *</code><var>valtype</var><code>, struct regcache *</code><var>regcache</var><code>, void *</code><var>readbuf</var><code>, const void *</code><var>writebuf</var><code>)</code><dd><a name="index-gdbarch_005freturn_005fvalue-383"></a><a name="gdbarch_005freturn_005fvalue"></a> Given a function with a return-value of
type <var>rettype</var>, return which return-value convention that function
would use.

     <p><span class="sc">gdb</span> currently recognizes two function return-value conventions:
<code>RETURN_VALUE_REGISTER_CONVENTION</code> where the return value is found
in registers; and <code>RETURN_VALUE_STRUCT_CONVENTION</code> where the return
value is found in memory and the address of that memory location is
passed in as the function's first parameter.

     <p>If the register convention is being used, and <var>writebuf</var> is
non-<code>NULL</code>, also copy the return-value in <var>writebuf</var> into
<var>regcache</var>.

     <p>If the register convention is being used, and <var>readbuf</var> is
non-<code>NULL</code>, also copy the return value from <var>regcache</var> into
<var>readbuf</var> (<var>regcache</var> contains a copy of the registers from the
just returned function).

     <p>See <a href="DEPRECATED_005fEXTRACT_005fSTRUCT_005fVALUE_005fADDRESS.html#DEPRECATED_005fEXTRACT_005fSTRUCT_005fVALUE_005fADDRESS">DEPRECATED_EXTRACT_STRUCT_VALUE_ADDRESS</a>, for a description of how
return-values that use the struct convention are handled.

     <p><em>Maintainer note: This method replaces separate predicate, extract,
store methods.  By having only one method, the logic needed to determine
the return-value convention need only be implemented in one place.  If
</em><span class="sc">gdb</span><em> were written in an </em><span class="sc">oo</span><em> language, this method would
instead return an object that knew how to perform the register
return-value extract and store.</em>

     <p><em>Maintainer note: This method does not take a </em><var>gcc_p</var><em>
parameter, and such a parameter should not be added.  If an architecture
that requires per-compiler or per-function information be identified,
then the replacement of </em><var>rettype</var><em> with </em><code>struct value</code>
<var>function</var><em> should be pursued.</em>

     <p><em>Maintainer note: The </em><var>regcache</var><em> parameter limits this methods
to the inner most frame.  While replacing </em><var>regcache</var><em> with a
</em><code>struct frame_info</code> <var>frame</var><em> parameter would remove that
limitation there has yet to be a demonstrated need for such a change.</em>

     <br><dt><code>SKIP_PERMANENT_BREAKPOINT</code><dd><a name="index-SKIP_005fPERMANENT_005fBREAKPOINT-384"></a>Advance the inferior's PC past a permanent breakpoint.  <span class="sc">gdb</span> normally
steps over a breakpoint by removing it, stepping one instruction, and
re-inserting the breakpoint.  However, permanent breakpoints are
hardwired into the inferior, and can't be removed, so this strategy
doesn't work.  Calling <code>SKIP_PERMANENT_BREAKPOINT</code> adjusts the processor's
state so that execution will resume just after the breakpoint.  This
macro does the right thing even when the breakpoint is in the delay slot
of a branch or jump.

     <br><dt><code>SKIP_PROLOGUE (</code><var>pc</var><code>)</code><dd><a name="index-SKIP_005fPROLOGUE-385"></a>A C expression that returns the address of the &ldquo;real&rdquo; code beyond the
function entry prologue found at <var>pc</var>.

     <br><dt><code>SKIP_TRAMPOLINE_CODE (</code><var>pc</var><code>)</code><dd><a name="index-SKIP_005fTRAMPOLINE_005fCODE-386"></a>If the target machine has trampoline code that sits between callers and
the functions being called, then define this macro to return a new PC
that is at the start of the real function.

     <br><dt><code>SP_REGNUM</code><dd><a name="index-SP_005fREGNUM-387"></a>If the stack-pointer is kept in a register, then define this macro to be
the number (greater than or equal to zero) of that register, or -1 if
there is no such register.

     <br><dt><code>STAB_REG_TO_REGNUM</code><dd><a name="index-STAB_005fREG_005fTO_005fREGNUM-388"></a>Define this to convert stab register numbers (as gotten from `r'
declarations) into <span class="sc">gdb</span> regnums.  If not defined, no conversion will be
done.

     <br><dt><code>DEPRECATED_STACK_ALIGN (</code><var>addr</var><code>)</code><dd><a name="DEPRECATED_005fSTACK_005fALIGN"></a>
<a name="index-DEPRECATED_005fSTACK_005fALIGN-389"></a>Define this to increase <var>addr</var> so that it meets the alignment
requirements for the processor's stack.

     <p>Unlike <a href="frame_005falign.html#frame_005falign">frame_align</a>, this function always adjusts <var>addr</var>
upwards.

     <p>By default, no stack alignment is performed.

     <br><dt><code>STEP_SKIPS_DELAY (</code><var>addr</var><code>)</code><dd><a name="index-STEP_005fSKIPS_005fDELAY-390"></a>Define this to return true if the address is of an instruction with a
delay slot.  If a breakpoint has been placed in the instruction's delay
slot, <span class="sc">gdb</span> will single-step over that instruction before resuming
normally.  Currently only defined for the Mips.

     <br><dt><code>STORE_RETURN_VALUE (</code><var>type</var><code>, </code><var>regcache</var><code>, </code><var>valbuf</var><code>)</code><dd><a name="index-STORE_005fRETURN_005fVALUE-391"></a>A C expression that writes the function return value, found in
<var>valbuf</var>, into the <var>regcache</var>.  <var>type</var> is the type of the
value that is to be returned.

     <p>This method has been deprecated in favour of <code>gdbarch_return_value</code>
(see <a href="gdbarch_005freturn_005fvalue.html#gdbarch_005freturn_005fvalue">gdbarch_return_value</a>).

     <br><dt><code>SYMBOL_RELOADING_DEFAULT</code><dd><a name="index-SYMBOL_005fRELOADING_005fDEFAULT-392"></a>The default value of the &ldquo;symbol-reloading&rdquo; variable.  (Never defined in
current sources.)

     <br><dt><code>TARGET_CHAR_BIT</code><dd><a name="index-TARGET_005fCHAR_005fBIT-393"></a>Number of bits in a char; defaults to 8.

     <br><dt><code>TARGET_CHAR_SIGNED</code><dd><a name="index-TARGET_005fCHAR_005fSIGNED-394"></a>Non-zero if <code>char</code> is normally signed on this architecture; zero if
it should be unsigned.

     <p>The ISO C standard requires the compiler to treat <code>char</code> as
equivalent to either <code>signed char</code> or <code>unsigned char</code>; any
character in the standard execution set is supposed to be positive. 
Most compilers treat <code>char</code> as signed, but <code>char</code> is unsigned
on the IBM S/390, RS6000, and PowerPC targets.

     <br><dt><code>TARGET_COMPLEX_BIT</code><dd><a name="index-TARGET_005fCOMPLEX_005fBIT-395"></a>Number of bits in a complex number; defaults to <code>2 * TARGET_FLOAT_BIT</code>.

     <p>At present this macro is not used.

     <br><dt><code>TARGET_DOUBLE_BIT</code><dd><a name="index-TARGET_005fDOUBLE_005fBIT-396"></a>Number of bits in a double float; defaults to <code>8 * TARGET_CHAR_BIT</code>.

     <br><dt><code>TARGET_DOUBLE_COMPLEX_BIT</code><dd><a name="index-TARGET_005fDOUBLE_005fCOMPLEX_005fBIT-397"></a>Number of bits in a double complex; defaults to <code>2 * TARGET_DOUBLE_BIT</code>.

     <p>At present this macro is not used.

     <br><dt><code>TARGET_FLOAT_BIT</code><dd><a name="index-TARGET_005fFLOAT_005fBIT-398"></a>Number of bits in a float; defaults to <code>4 * TARGET_CHAR_BIT</code>.

     <br><dt><code>TARGET_INT_BIT</code><dd><a name="index-TARGET_005fINT_005fBIT-399"></a>Number of bits in an integer; defaults to <code>4 * TARGET_CHAR_BIT</code>.

     <br><dt><code>TARGET_LONG_BIT</code><dd><a name="index-TARGET_005fLONG_005fBIT-400"></a>Number of bits in a long integer; defaults to <code>4 * TARGET_CHAR_BIT</code>.

     <br><dt><code>TARGET_LONG_DOUBLE_BIT</code><dd><a name="index-TARGET_005fLONG_005fDOUBLE_005fBIT-401"></a>Number of bits in a long double float;
defaults to <code>2 * TARGET_DOUBLE_BIT</code>.

     <br><dt><code>TARGET_LONG_LONG_BIT</code><dd><a name="index-TARGET_005fLONG_005fLONG_005fBIT-402"></a>Number of bits in a long long integer; defaults to <code>2 * TARGET_LONG_BIT</code>.

     <br><dt><code>TARGET_PTR_BIT</code><dd><a name="index-TARGET_005fPTR_005fBIT-403"></a>Number of bits in a pointer; defaults to <code>TARGET_INT_BIT</code>.

     <br><dt><code>TARGET_SHORT_BIT</code><dd><a name="index-TARGET_005fSHORT_005fBIT-404"></a>Number of bits in a short integer; defaults to <code>2 * TARGET_CHAR_BIT</code>.

     <br><dt><code>TARGET_READ_PC</code><dd><a name="index-TARGET_005fREAD_005fPC-405"></a><dt><code>TARGET_WRITE_PC (</code><var>val</var><code>, </code><var>pid</var><code>)</code><dd><a name="index-TARGET_005fWRITE_005fPC-406"></a><a name="TARGET_005fWRITE_005fPC"></a>
<dt><code>TARGET_READ_SP</code><dd><a name="index-TARGET_005fREAD_005fSP-407"></a><dt><code>TARGET_READ_FP</code><dd><a name="index-TARGET_005fREAD_005fFP-408"></a><a name="index-read_005fpc-409"></a><a name="index-write_005fpc-410"></a><a name="index-read_005fsp-411"></a><a name="index-read_005ffp-412"></a><a name="TARGET_005fREAD_005fSP"></a> These change the behavior of <code>read_pc</code>,
<code>write_pc</code>, and <code>read_sp</code>.  For most targets, these may be
left undefined.  <span class="sc">gdb</span> will call the read and write register
functions with the relevant <code>_REGNUM</code> argument.

     <p>These macros are useful when a target keeps one of these registers in a
hard to get at place; for example, part in a segment register and part
in an ordinary register.

     <p>See <a href="unwind_005fsp.html#unwind_005fsp">unwind_sp</a>, which replaces <code>TARGET_READ_SP</code>.

     <br><dt><code>TARGET_VIRTUAL_FRAME_POINTER(</code><var>pc</var><code>, </code><var>regp</var><code>, </code><var>offsetp</var><code>)</code><dd><a name="index-TARGET_005fVIRTUAL_005fFRAME_005fPOINTER-413"></a>Returns a <code>(register, offset)</code> pair representing the virtual frame
pointer in use at the code address <var>pc</var>.  If virtual frame pointers
are not used, a default definition simply returns
<code>DEPRECATED_FP_REGNUM</code>, with an offset of zero.

     <br><dt><code>TARGET_HAS_HARDWARE_WATCHPOINTS</code><dd>If non-zero, the target has support for hardware-assisted
watchpoints.  See <a href="Algorithms.html#Algorithms">watchpoints</a>, for more details and
other related macros.

     <br><dt><code>TARGET_PRINT_INSN (</code><var>addr</var><code>, </code><var>info</var><code>)</code><dd><a name="index-TARGET_005fPRINT_005fINSN-414"></a>This is the function used by <span class="sc">gdb</span> to print an assembly
instruction.  It prints the instruction at address <var>addr</var> in
debugged memory and returns the length of the instruction, in bytes.  If
a target doesn't define its own printing routine, it defaults to an
accessor function for the global pointer
<code>deprecated_tm_print_insn</code>.  This usually points to a function in
the <code>opcodes</code> library (see <a href="Support-Libraries.html#Support-Libraries">Opcodes</a>). 
<var>info</var> is a structure (of type <code>disassemble_info</code>) defined in
<samp><span class="file">include/dis-asm.h</span></samp> used to pass information to the instruction
decoding routine.

     <br><dt><code>struct frame_id unwind_dummy_id (struct frame_info *</code><var>frame</var><code>)</code><dd><a name="index-unwind_005fdummy_005fid-415"></a><a name="unwind_005fdummy_005fid"></a> Given <var>frame</var> return a <code>struct
frame_id</code> that uniquely identifies an inferior function call's dummy
frame.  The value returned must match the dummy frame stack value
previously saved using <code>SAVE_DUMMY_FRAME_TOS</code>. 
See <a href="SAVE_005fDUMMY_005fFRAME_005fTOS.html#SAVE_005fDUMMY_005fFRAME_005fTOS">SAVE_DUMMY_FRAME_TOS</a>.

     <br><dt><code>DEPRECATED_USE_STRUCT_CONVENTION (</code><var>gcc_p</var><code>, </code><var>type</var><code>)</code><dd><a name="index-DEPRECATED_005fUSE_005fSTRUCT_005fCONVENTION-416"></a>If defined, this must be an expression that is nonzero if a value of the
given <var>type</var> being returned from a function must have space
allocated for it on the stack.  <var>gcc_p</var> is true if the function
being considered is known to have been compiled by GCC; this is helpful
for systems where GCC is known to use different calling convention than
other compilers.

     <p>This method has been deprecated in favour of <code>gdbarch_return_value</code>
(see <a href="gdbarch_005freturn_005fvalue.html#gdbarch_005freturn_005fvalue">gdbarch_return_value</a>).

     <br><dt><code>VALUE_TO_REGISTER(</code><var>type</var><code>, </code><var>regnum</var><code>, </code><var>from</var><code>, </code><var>to</var><code>)</code><dd><a name="index-VALUE_005fTO_005fREGISTER-417"></a>Convert a value of type <var>type</var> into the raw contents of register
<var>regnum</var>'s. 
See <a href="Target-Architecture-Definition.html#Target-Architecture-Definition">Using Different Register and Memory Data Representations</a>.

     <br><dt><code>VARIABLES_INSIDE_BLOCK (</code><var>desc</var><code>, </code><var>gcc_p</var><code>)</code><dd><a name="index-VARIABLES_005fINSIDE_005fBLOCK-418"></a>For dbx-style debugging information, if the compiler puts variable
declarations inside LBRAC/RBRAC blocks, this should be defined to be
nonzero.  <var>desc</var> is the value of <code>n_desc</code> from the
<code>N_RBRAC</code> symbol, and <var>gcc_p</var> is true if <span class="sc">gdb</span> has noticed the
presence of either the <code>GCC_COMPILED_SYMBOL</code> or the
<code>GCC2_COMPILED_SYMBOL</code>.  By default, this is 0.

     <br><dt><code>OS9K_VARIABLES_INSIDE_BLOCK (</code><var>desc</var><code>, </code><var>gcc_p</var><code>)</code><dd><a name="index-OS9K_005fVARIABLES_005fINSIDE_005fBLOCK-419"></a>Similarly, for OS/9000.  Defaults to 1. 
</dl>

   <p>Motorola M68K target conditionals.

     <dl>
<dt><code>BPT_VECTOR</code><a name="index-BPT_005fVECTOR-420"></a><dd>Define this to be the 4-bit location of the breakpoint trap vector.  If
not defined, it will default to <code>0xf</code>.

     <br><dt><code>REMOTE_BPT_VECTOR</code><a name="index-REMOTE_005fBPT_005fVECTOR-421"></a><dd>Defaults to <code>1</code>.

     <br><dt><code>NAME_OF_MALLOC</code><a name="index-NAME_005fOF_005fMALLOC-422"></a><dd><a name="index-NAME_005fOF_005fMALLOC-423"></a>A string containing the name of the function to call in order to
allocate some memory in the inferior. The default value is "malloc".

   </dl>

<h3 class="section">9.12 Adding a New Target</h3>

<p><a name="index-adding-a-target-424"></a>The following files add a target to <span class="sc">gdb</span>:

     
<a name="index-TDEPFILES-425"></a>
<dl><dt><samp><span class="file">gdb/config/</span><var>arch</var><span class="file">/</span><var>ttt</var><span class="file">.mt</span></samp><dd>Contains a Makefile fragment specific to this target.  Specifies what
object files are needed for target <var>ttt</var>, by defining
`<samp><span class="samp">TDEPFILES=...</span></samp>' and `<samp><span class="samp">TDEPLIBS=...</span></samp>'.  Also specifies
the header file which describes <var>ttt</var>, by defining `<samp><span class="samp">TM_FILE=
tm-</span><var>ttt</var><span class="samp">.h</span></samp>'.

     <p>You can also define `<samp><span class="samp">TM_CFLAGS</span></samp>', `<samp><span class="samp">TM_CLIBS</span></samp>', `<samp><span class="samp">TM_CDEPS</span></samp>',
but these are now deprecated, replaced by autoconf, and may go away in
future versions of <span class="sc">gdb</span>.

     <br><dt><samp><span class="file">gdb/</span><var>ttt</var><span class="file">-tdep.c</span></samp><dd>Contains any miscellaneous code required for this target machine.  On
some machines it doesn't exist at all.  Sometimes the macros in
<samp><span class="file">tm-</span><var>ttt</var><span class="file">.h</span></samp> become very complicated, so they are implemented
as functions here instead, and the macro is simply defined to call the
function.  This is vastly preferable, since it is easier to understand
and debug.

     <br><dt><samp><span class="file">gdb/</span><var>arch</var><span class="file">-tdep.c</span></samp><dt><samp><span class="file">gdb/</span><var>arch</var><span class="file">-tdep.h</span></samp><dd>This often exists to describe the basic layout of the target machine's
processor chip (registers, stack, etc.).  If used, it is included by
<samp><var>ttt</var><span class="file">-tdep.h</span></samp>.  It can be shared among many targets that use
the same processor.

     <br><dt><samp><span class="file">gdb/config/</span><var>arch</var><span class="file">/tm-</span><var>ttt</var><span class="file">.h</span></samp><dd>(<samp><span class="file">tm.h</span></samp> is a link to this file, created by <code>configure</code>).  Contains
macro definitions about the target machine's registers, stack frame
format and instructions.

     <p>New targets do not need this file and should not create it.

     <br><dt><samp><span class="file">gdb/config/</span><var>arch</var><span class="file">/tm-</span><var>arch</var><span class="file">.h</span></samp><dd>This often exists to describe the basic layout of the target machine's
processor chip (registers, stack, etc.).  If used, it is included by
<samp><span class="file">tm-</span><var>ttt</var><span class="file">.h</span></samp>.  It can be shared among many targets that use the
same processor.

     <p>New targets do not need this file and should not create it.

   </dl>

   <p>If you are adding a new operating system for an existing CPU chip, add a
<samp><span class="file">config/tm-</span><var>os</var><span class="file">.h</span></samp> file that describes the operating system
facilities that are unusual (extra symbol table info; the breakpoint
instruction needed; etc.).  Then write a <samp><var>arch</var><span class="file">/tm-</span><var>os</var><span class="file">.h</span></samp>
that just <code>#include</code>s <samp><span class="file">tm-</span><var>arch</var><span class="file">.h</span></samp> and
<samp><span class="file">config/tm-</span><var>os</var><span class="file">.h</span></samp>.

<h3 class="section">9.13 Converting an existing Target Architecture to Multi-arch</h3>

<p><a name="index-converting-targets-to-multi_002darch-426"></a>
This section describes the current accepted best practice for converting
an existing target architecture to the multi-arch framework.

   <p>The process consists of generating, testing, posting and committing a
sequence of patches.  Each patch must contain a single change, for
instance:

     <ul>
<li>Directly convert a group of functions into macros (the conversion does
not change the behavior of any of the functions).

     <li>Replace a non-multi-arch with a multi-arch mechanism (e.g.,
<code>FRAME_INFO</code>).

     <li>Enable multi-arch level one.

     <li>Delete one or more files.

   </ul>

<p class="noindent">There isn't a size limit on a patch, however, a developer is strongly
encouraged to keep the patch size down.

   <p>Since each patch is well defined, and since each change has been tested
and shows no regressions, the patches are considered <em>fairly</em>
obvious.  Such patches, when submitted by developers listed in the
<samp><span class="file">MAINTAINERS</span></samp> file, do not need approval.  Occasional steps in the
process may be more complicated and less clear.  The developer is
expected to use their judgment and is encouraged to seek advice as
needed.

<h4 class="subsection">9.13.1 Preparation</h4>

<p>The first step is to establish control.  Build (with <samp><span class="option">-Werror</span></samp>
enabled) and test the target so that there is a baseline against which
the debugger can be compared.

   <p>At no stage can the test results regress or <span class="sc">gdb</span> stop compiling
with <samp><span class="option">-Werror</span></samp>.

<h4 class="subsection">9.13.2 Add the multi-arch initialization code</h4>

<p>The objective of this step is to establish the basic multi-arch
framework.  It involves

     <ul>
<li>The addition of a <var>arch</var><code>_gdbarch_init</code> function<a rel="footnote" href="#fn-2" name="fnd-2"><sup>2</sup></a> that creates
the architecture:
     <pre class="smallexample">          static struct gdbarch *
          d10v_gdbarch_init (info, arches)
               struct gdbarch_info info;
               struct gdbarch_list *arches;
          {
            struct gdbarch *gdbarch;
            /* there is only one d10v architecture */
            if (arches != NULL)
              return arches-&gt;gdbarch;
            gdbarch = gdbarch_alloc (&amp;info, NULL);
            return gdbarch;
          }
     </pre>
     <p class="noindent">

     <li>A per-architecture dump function to print any architecture specific
information:
     <pre class="smallexample">          static void
          mips_dump_tdep (struct gdbarch *current_gdbarch,
                          struct ui_file *file)
          {
             ... code to print architecture specific info ...
          }
     </pre>
     <li>A change to <code>_initialize_</code><var>arch</var><code>_tdep</code> to register this new
architecture:
     <pre class="smallexample">          void
          _initialize_mips_tdep (void)
          {
            gdbarch_register (bfd_arch_mips, mips_gdbarch_init,
                              mips_dump_tdep);
     </pre>
     <li>Add the macro <code>GDB_MULTI_ARCH</code>, defined as 0 (zero), to the file<br>
<samp><span class="file">config/</span><var>arch</var><span class="file">/tm-</span><var>arch</var><span class="file">.h</span></samp>.

   </ul>

<h4 class="subsection">9.13.3 Update multi-arch incompatible mechanisms</h4>

<p>Some mechanisms do not work with multi-arch.  They include:

     <dl>
<dt><code>FRAME_FIND_SAVED_REGS</code><dd>Replaced with <code>DEPRECATED_FRAME_INIT_SAVED_REGS</code>
</dl>

<p class="noindent">At this stage you could also consider converting the macros into
functions.

<h4 class="subsection">9.13.4 Prepare for multi-arch level to one</h4>

<p>Temporally set <code>GDB_MULTI_ARCH</code> to <code>GDB_MULTI_ARCH_PARTIAL</code>
and then build and start <span class="sc">gdb</span> (the change should not be
committed).  <span class="sc">gdb</span> may not build, and once built, it may die with
an internal error listing the architecture methods that must be
provided.

   <p>Fix any build problems (patch(es)).

   <p>Convert all the architecture methods listed, which are only macros, into
functions (patch(es)).

   <p>Update <var>arch</var><code>_gdbarch_init</code> to set all the missing
architecture methods and wrap the corresponding macros in <code>#if
!GDB_MULTI_ARCH</code> (patch(es)).

<h4 class="subsection">9.13.5 Set multi-arch level one</h4>

<p>Change the value of <code>GDB_MULTI_ARCH</code> to GDB_MULTI_ARCH_PARTIAL (a
single patch).

   <p>Any problems with throwing &ldquo;the switch&rdquo; should have been fixed
already.

<h4 class="subsection">9.13.6 Convert remaining macros</h4>

<p>Suggest converting macros into functions (and setting the corresponding
architecture method) in small batches.

<h4 class="subsection">9.13.7 Set multi-arch level to two</h4>

<p>This should go smoothly.

<h4 class="subsection">9.13.8 Delete the TM file</h4>

<p>The <samp><span class="file">tm-</span><var>arch</var><span class="file">.h</span></samp> can be deleted.  <samp><var>arch</var><span class="file">.mt</span></samp> and
<samp><span class="file">configure.in</span></samp> updated.

   <div class="footnote">
<hr>
<h4>Footnotes</h4><p class="footnote"><small>[<a name="fn-1" href="#fnd-1">1</a>]</small> Some D10V instructions are
actually pairs of 16-bit sub-instructions.  However, since you can't
jump into the middle of such a pair, code addresses can only refer to
full 32 bit instructions, which is what matters in this explanation.</p>

   <p class="footnote"><small>[<a name="fn-2" href="#fnd-2">2</a>]</small> The
above is from the original example and uses K&amp;R C.  <span class="sc">gdb</span>
has since converted to ISO C but lets ignore that.</p>

   <p><hr></div>

   </body></html>

