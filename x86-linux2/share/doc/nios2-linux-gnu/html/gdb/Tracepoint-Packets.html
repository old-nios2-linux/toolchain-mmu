<html lang="en">
<head>
<title>Tracepoint Packets - Debugging with GDB</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Debugging with GDB">
<meta name="generator" content="makeinfo 4.7">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Remote-Protocol.html#Remote-Protocol" title="Remote Protocol">
<link rel="prev" href="Register-Packet-Format.html#Register-Packet-Format" title="Register Packet Format">
<link rel="next" href="Interrupts.html#Interrupts" title="Interrupts">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc { font-variant:small-caps }
  span.roman { font-family: serif; font-weight: normal; } 
--></style>
</head>
<body>
<div class="node">
<p>
<a name="Tracepoint-Packets"></a>Next:&nbsp;<a rel="next" accesskey="n" href="Interrupts.html#Interrupts">Interrupts</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Register-Packet-Format.html#Register-Packet-Format">Register Packet Format</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Remote-Protocol.html#Remote-Protocol">Remote Protocol</a>
<hr><br>
</div>

<h3 class="section">D.7 Tracepoint Packets</h3>

<p><a name="index-tracepoint-packets-1794"></a><a name="index-packets_002c-tracepoint-1795"></a>
Here we describe the packets <span class="sc">gdb</span> uses to implement
tracepoints (see <a href="Tracepoints.html#Tracepoints">Tracepoints</a>).

     <dl>
<dt><span class="samp">QTDP:</span><var>n</var><span class="samp">:</span><var>addr</var><span class="samp">:</span><var>ena</var><span class="samp">:</span><var>step</var><span class="samp">:</span><var>pass</var><span class="samp">[-]</span><dd>Create a new tracepoint, number <var>n</var>, at <var>addr</var>.  If <var>ena</var>
is <span class="samp">E</span>, then the tracepoint is enabled; if it is <span class="samp">D</span>, then
the tracepoint is disabled.  <var>step</var> is the tracepoint's step
count, and <var>pass</var> is its pass count.  If the trailing <span class="samp">-</span> is
present, further <span class="samp">QTDP</span> packets will follow to specify this
tracepoint's actions.

     <p>Replies:
          <dl>
<dt><span class="samp">OK</span><dd>The packet was understood and carried out. 
</dl>

     <br><dt><span class="samp">QTDP:-</span><var>n</var><span class="samp">:</span><var>addr</var><span class="samp">:[S]</span><var>action</var><span class="samp">...[-]</span><dd>Define actions to be taken when a tracepoint is hit.  <var>n</var> and
<var>addr</var> must be the same as in the initial <span class="samp">QTDP</span> packet for
this tracepoint.  This packet may only be sent immediately after
another <span class="samp">QTDP</span> packet that ended with a <span class="samp">-</span>.  If the
trailing <span class="samp">-</span> is present, further <span class="samp">QTDP</span> packets will follow,
specifying more actions for this tracepoint.

     <p>In the series of action packets for a given tracepoint, at most one
can have an <span class="samp">S</span> before its first <var>action</var>.  If such a packet
is sent, it and the following packets define &ldquo;while-stepping&rdquo;
actions.  Any prior packets define ordinary actions &mdash; that is, those
taken when the tracepoint is first hit.  If no action packet has an
<span class="samp">S</span>, then all the packets in the series specify ordinary
tracepoint actions.

     <p>The <var>action</var><span class="samp">...</span> portion of the packet is a series of
actions, concatenated without separators.  Each action has one of the
following forms:

          <dl>
<dt><span class="samp">R </span><var>mask</var><dd>Collect the registers whose bits are set in <var>mask</var>.  <var>mask</var> is
a hexadecimal number whose <var>i</var>'th bit is set if register number
<var>i</var> should be collected.  (The least significant bit is numbered
zero.)  Note that <var>mask</var> may be any number of digits long; it may
not fit in a 32-bit word.

          <br><dt><span class="samp">M </span><var>basereg</var><span class="samp">,</span><var>offset</var><span class="samp">,</span><var>len</var><dd>Collect <var>len</var> bytes of memory starting at the address in register
number <var>basereg</var>, plus <var>offset</var>.  If <var>basereg</var> is
<span class="samp">-1</span>, then the range has a fixed address: <var>offset</var> is the
address of the lowest byte to collect.  The <var>basereg</var>,
<var>offset</var>, and <var>len</var> parameters are all unsigned hexadecimal
values (the <span class="samp">-1</span> value for <var>basereg</var> is a special case).

          <br><dt><span class="samp">X </span><var>len</var><span class="samp">,</span><var>expr</var><dd>Evaluate <var>expr</var>, whose length is <var>len</var>, and collect memory as
it directs.  <var>expr</var> is an agent expression, as described in
<a href="Agent-Expressions.html#Agent-Expressions">Agent Expressions</a>.  Each byte of the expression is encoded as a
two-digit hex number in the packet; <var>len</var> is the number of bytes
in the expression (and thus one-half the number of hex digits in the
packet).

     </dl>

     <p>Any number of actions may be packed together in a single <span class="samp">QTDP</span>
packet, as long as the packet does not exceed the maximum packet
length (400 bytes, for many stubs).  There may be only one <span class="samp">R</span>
action per tracepoint, and it must precede any <span class="samp">M</span> or <span class="samp">X</span>
actions.  Any registers referred to by <span class="samp">M</span> and <span class="samp">X</span> actions
must be collected by a preceding <span class="samp">R</span> action.  (The
&ldquo;while-stepping&rdquo; actions are treated as if they were attached to a
separate tracepoint, as far as these restrictions are concerned.)

     <p>Replies:
          <dl>
<dt><span class="samp">OK</span><dd>The packet was understood and carried out. 
</dl>

     <br><dt><span class="samp">QTFrame:</span><var>n</var><dd>Select the <var>n</var>'th tracepoint frame from the buffer, and use the
register and memory contents recorded there to answer subsequent
request packets from <span class="sc">gdb</span>.

     <p>A successful reply from the stub indicates that the stub has found the
requested frame.  The response is a series of parts, concatenated
without separators, describing the frame we selected.  Each part has
one of the following forms:

          <dl>
<dt><span class="samp">F </span><var>f</var><dd>The selected frame is number <var>n</var> in the trace frame buffer;
<var>f</var> is a hexadecimal number.  If <var>f</var> is <span class="samp">-1</span>, then there
was no frame matching the criteria in the request packet.

          <br><dt><span class="samp">T </span><var>t</var><dd>The selected trace frame records a hit of tracepoint number <var>t</var>;
<var>t</var> is a hexadecimal number.

     </dl>

     <br><dt><span class="samp">QTFrame:pc:</span><var>addr</var><dd>Like <span class="samp">QTFrame:</span><var>n</var>, but select the first tracepoint frame after the
currently selected frame whose PC is <var>addr</var>;
<var>addr</var> is a hexadecimal number.

     <br><dt><span class="samp">QTFrame:tdp:</span><var>t</var><dd>Like <span class="samp">QTFrame:</span><var>n</var>, but select the first tracepoint frame after the
currently selected frame that is a hit of tracepoint <var>t</var>; <var>t</var>
is a hexadecimal number.

     <br><dt><span class="samp">QTFrame:range:</span><var>start</var><span class="samp">:</span><var>end</var><dd>Like <span class="samp">QTFrame:</span><var>n</var>, but select the first tracepoint frame after the
currently selected frame whose PC is between <var>start</var> (inclusive)
and <var>end</var> (exclusive); <var>start</var> and <var>end</var> are hexadecimal
numbers.

     <br><dt><span class="samp">QTFrame:outside:</span><var>start</var><span class="samp">:</span><var>end</var><dd>Like <span class="samp">QTFrame:range:</span><var>start</var><span class="samp">:</span><var>end</var>, but select the first
frame <em>outside</em> the given range of addresses.

     <br><dt><span class="samp">QTStart</span><dd>Begin the tracepoint experiment.  Begin collecting data from tracepoint
hits in the trace frame buffer.

     <br><dt><span class="samp">QTStop</span><dd>End the tracepoint experiment.  Stop collecting trace frames.

     <br><dt><span class="samp">QTinit</span><dd>Clear the table of tracepoints, and empty the trace frame buffer.

     <br><dt><span class="samp">QTro:</span><var>start1</var><span class="samp">,</span><var>end1</var><span class="samp">:</span><var>start2</var><span class="samp">,</span><var>end2</var><span class="samp">:...</span><dd>Establish the given ranges of memory as &ldquo;transparent&rdquo;.  The stub
will answer requests for these ranges from memory's current contents,
if they were not collected as part of the tracepoint hit.

     <p><span class="sc">gdb</span> uses this to mark read-only regions of memory, like those
containing program code.  Since these areas never change, they should
still have the same contents they did when the tracepoint was hit, so
there's no reason for the stub to refuse to provide their contents.

     <br><dt><span class="samp">qTStatus</span><dd>Ask the stub if there is a trace experiment running right now.

     <p>Replies:
          <dl>
<dt><span class="samp">T0</span><dd>There is no trace experiment running. 
<br><dt><span class="samp">T1</span><dd>There is a trace experiment running. 
</dl>

   </dl>

   </body></html>

